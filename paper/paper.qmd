---
title: "Men and past smokers from ontario are potentially more physically active than women and non-smokers"
subtitle: "Women are engaging in lesser physical activities than men. Furthermore, individuals who smoked before are more likely to engage in exercise. Consumption of stimulant-related drugs could have also increased as well, resulting in increased overall physical activities in Ontario."
author: 
  - Chris Yong Hong Sen
thanks: "Code and data are available at: [https://github.com/Monoji77/Alcohol_Use_Ontario](https://github.com/Monoji77/Alcohol_Use_Ontario)."
date: today
date-format: long
abstract: "This study explores factors influencing physical activity levels in Ontario, focusing on demographic and substance abuse. Our findings reveal that women engage in less physical activity than men, while individuals who have smoked in the past and those consuming stimulant-related drugs are more likely to exercise. Additionally, age, highest educational attainment, and health region also play significant roles in determining physical activity levels. These insights highlight the complex interplay of gender, lifestyle behaviors, and sociodemographic factors, providing valuable information for designing targeted public health interventions to promote physical activity."
format: 
  pdf:
    fig-pos: H
number-sections: true
bibliography: references.bib
---

```{r importing libraries}
#| include: false
#| warning: false
#| message: false

library(tidyverse)
library(palmerpenguins)
library(knitr)
```


# Introduction

Overview paragraph

Estimand paragraph
The estimand would be the actual effect of socio-demographic factors, substance abuse, and health factors on how much time is spent on strenuous activities among individuals in Ontario who engage in regular exercise.

Results paragraph

Why it matters paragraph

Telegraphing paragraph: The remainder of this paper is structured as follows. @sec-data....






# Data {#sec-data}

## Context of dataset

The dataset chosen is obtained from Computing in the Humanities and Social Sciences/CHASS at the university of Toronto [@SDA_CHASS], specifically the Canadian Community Health Survey (CCHS) annual component 2017-2018 which was collected by @StatisticsOfCanada. The goal of the CCHS survey is to collect comprehensive and reliable health-related data on the Canadian population to support health surveillance, research, and program evaluation. It aims to provide timely, accessible, and flexible data for monitoring health trends, studying small populations and rare characteristics, and addressing emerging health issues, ultimately helping improve the health and well-being of Canadians. 

Other datasets explored include sources from World Health Organisation and ParticipACTION. World Health Organisation provides aggregated data informing certain indicators of interest such as obesity levels and alcohol consumption. This can be found in the data section for Canada[@OtherSource1]. Also, ParticipACTION provides key statistics regarding proportion of adult population in canada meeting the national guidelines of 150 minutes of moderate to vigorous exercise, as well as how sedentary canadians are [@OtherSource2]. However, the availability of raw individual level data is absent from these sources. Although the aggregated data gives us a sensing about general Canadian health, we are not able to focus our attention to the Ontario population. The dataset chosen from Canadian Community Health Survey (CCHS) annual component is ideal as it contains individual level data, where we are able to obtain the province the respondents are from. 

## Original Dataset

The dataset provides 113,290 individual response from Canadians all throughout the country. Surveys were conducted to collect health-related data from respondents. The relevant data collected includes...

- Demographics and Identity: 
Age, gender, marital status, citizenship, Aboriginal identity, visible minority status, immigrant status, language (mother tongue, spoken at home, first official), sexual orientation.

- Health Status and Conditions:
Chronic diseases, neurological conditions, mental health indicators, perceived physical and mental health, pain, discomfort, activity limitations, and disabilities.


- Health Behaviors and Lifestyle:
Smoking, drinking, cannabis use, physical activity, helmet use, dietary practices (e.g., fruits, vegetables), breastfeeding, and BMI.

- Health Care Access and Utilization:
Contact with health professionals, access to health services, immunizations (e.g., flu shots), cancer screenings (e.g., mammograms, pap smears), waiting times, and satisfaction with services.

- Socio-Economic Factors: 
Educational attainment, work activity, household income, living arrangements, presence of children in the household, food insecurity.

- Life Quality and Perceptions:
Life satisfaction, life stress, sense of belonging, health-adjusted life expectancy.

- Specialized Health Indicators:
Two-week disability days, quality and ratings of health care services, functional health status.

- Specific Population Measures:
Aboriginal group, immigrant duration, visible minority, minority health disparities.

- Geographic and Household Data:
Geographic location, number of persons or households, household demographics.

This dataset is highly suitable in determining both quantitative factors such as  c qualitative factors  


## Measurement {#sec-measurement}

Our goal is to explore the actual effect of socio-demographic factors, substance abuse, and health factors on how much time is spent on exercise among individuals in Ontario who engage in regular exercise. The instrument of measurement would be surveys. Through the cross-sectional survey conducted by CCHS, we are able to get the number of hours spent on vigorous exercise per individual, our response variable.

According to the questionnaire, respondents were asked in a phone survey to indicate whether they had engaged in any strenuous activity that lasted at least 10 minutes and made them sweat and breathe a little harder in the past 7 days. Afterwards, they were asked to indicate the total time spent on those activities. To address the concern of recall bias where an individual may not recall the specific timing in engaging with exercise, surveyors sectioned vigorous exercise into commuting, sports, work and volunteering. Then within each section, surveyors asked which day (Monday to Sunday) in the past week had they engaged in such exercise that made them sweat and breathe a little harder. By doing so, the activities individuals did during the past week would be anchored on the days of the week. Following this would be for the respondents to indicate the total number of hours they engaged in each
section of vigorous exercise for the past 7 days.

In addition, the explanatory variables we are interested in were also obtained in the same survey. 

For socio-demographic factors possibly affecting time spent on vigorous exercise, the surveyors asked the respondent for their age (DHH_AGE) from 0 years old to 121 years old), sex (DHH_SEX) being either male or female, personal income obtained from tax forms submitted to the Canada Revenue Agency upon consent from respondent, geographical health region (ADM_Q037) that was provided by respondents when they agreed to the phone survey, and highest educational attainment (EHG2_04) ranging from less than high school diploma to master's degree and above. 

For substance abuse, respondents were asked how frequent they consumed alcoholic drinks in the past 12 months (ALC_Q015), ranging from less than once per month to everyday. Surveyors also asked respondents for usage of drugs including one-time marijuana or hashish in the past 12 months (DRG_Q005 to DRG_Q075), and whether they have smoked hundred cigarettes in the past 12 months (SMK_Q020). The last 2 questions allowed respondents to indicate a simple yes or no flag to express their answer.

For health factors, questions were asked to determine an individual's body mass index ranging from underweight to obese and perceived life/work stress ranging from not at all stressful to extremely stressful. Additionally, surveyors asked respondents if they have mood disorders (E.g. depression, bipolarism, mania), for which respondents replied with a simple yes or no. 

Overall, each entry obtained by respondents assigns quantitative values to each factor and the the response for which we can explore subsequently using linear regression to determine which factors have greater influence in the time spent exercising amongst individuals that are engaged in exercising.


## Response variable: Time spent on vigorous activity in the past 7 days

From the CCHS dataset, we look at paadvmva variable. This variable is continuous with values ranging from 0 to 9902 representing the number of minutes spent on vigorous activity in the past 7 days. For easier readability, the variable will be renamed as time_spent_vigorous_exercise_7d.  As explained in section @sec-measurement, this variable measures the time spent on any activities lasting more than 10 minutes that makes an individual sweat more than they normally would. This would include individuals undertaking laborious employment or volunteering efforts, or it could simply include individuals who do cardio and/or strength training.    

By using this variable, we are assuming that the routine of an individual from the past 7 days is indicative of their general routine beyond the past 7 days. This variable may not account for individuals who only began vigorous sweating routine within the past 7 days and were sedentary before, which may not be helpful if included in subsequent model fitting.

Since we are interested in individuals that are already engaging in strenuous activities, we can filter time_spent_vigorous_exercise_7d to exclude 0. After removing such entries, we obtain the following summary statistics as shown in @tbl-summarised_statistics_time_spent_vigorous_exercise_7d. The median time spent on vigorous activities the past 7 days would be 300 minutes, which averages out to 43 minutes per day. 

```{r}
#| echo: false
#| warning: false
#| message: false
#| label: tbl-summarised_statistics_time_spent_vigorous_exercise_7d
#| tbl-cap: Summarised statistics for time spent on vigorous exercise in the past 7 days

original_data <- read_csv("../data/02-analysis_data/analysis_data.csv") 

data_cleaned_1 <- original_data |>
  filter(time_spent_vigorous_exercise_7d != 0) 

# data_cleaned_1 |>
#   top_n(10, time_spent_vigorous_exercise_7d) |>
#   select(time_spent_vigorous_exercise_7d) |>
#   arrange(desc(time_spent_vigorous_exercise_7d))

kable(data_cleaned_1 |>
  summarise(`Min.` = min(time_spent_vigorous_exercise_7d),
            `1st Qu.` = quantile(time_spent_vigorous_exercise_7d, 0.25),
            Median = median(time_spent_vigorous_exercise_7d),
            `3rd Qu.` = quantile(time_spent_vigorous_exercise_7d, 0.75),
            `Max.` = max(time_spent_vigorous_exercise_7d)))

###############
# function: obtain outlier observations 
#
#
###############

# first_quartile <- quantile(data_cleaned_1$time_spent_vigorous_exercise_7d, 0.25)
# third_quartile <- quantile(data_cleaned_1$time_spent_vigorous_exercise_7d, 0.75)
# IQR <- third_quartile - first_quartile
# outlier_observation <- data_cleaned_1 |>
#   filter(time_spent_vigorous_exercise_7d < (first_quartile - 1.5*IQR) | 
#            time_spent_vigorous_exercise_7d > (third_quartile + 1.5*IQR))
# nrow(outlier_observation)
# round(nrow(outlier_observation)/nrow(data_cleaned_1) * 100,0)
```

Interestingly, the maximum time spent on vigorous activities the past 7 days was 9902 minutes, and this averages to 1415 minutes per day, which is equivalent to 23.5 hours in a day. This is very unlikely as this suggests that an individual is constantly engaging in physical strenuous activity without sleeping. Logically, this suggests the possibility of outlier values. By observing @fig-boxplot_time_spent_vigorous_exercise_7d, there are many outlier observations for this variable. Roughly 10% of the observed data are considered outliers as they fall outside 1.5 times the interquartile range from the 25% and 75% quartile values. We would be performing log transformation which would be discussed in section (INSERT SECTION HERE PLEASE DONT FORGET) which would address these outlier values.  


```{r}
#| echo: false
#| warning: false
#| message: false
#| label: fig-boxplot_time_spent_vigorous_exercise_7d
#| fig-cap: Boxplot of time spent on vigorous exercise in the past 7 days
#boxplot(data_cleaned_1$time_spent_vigorous_exercise_7d, outcol='indianred4')
ggplot(data_cleaned_1) +
  geom_boxplot(aes(y=time_spent_vigorous_exercise_7d), 
               outlier.color = 'indianred4', 
               outlier.alpha=0.2) +
  theme_minimal() +
  theme(axis.text.x = element_blank(),
        axis.ticks.x = element_blank()) +
  ylab('') +
  xlab('Boxplot of time spent on vigorous exercise in the past 7 days')
```

Subsequently, we would have to remove observations that are very unlikely as they do not represent the general population and could skew the distribution of time spent on vigorous exercise.

By observing the histogram generated in @fig-hist-time_spent_vigorous_exercise_7d, we obtain a severely right skewed response histogram where most observations lie between 0 to 500 minutes. For the building of linear models in subsequent sections of the paper, this would not be ideal as linear regression assumes a normal distribution of the response variable, suggesting that a transformation would be required to fit a linear regression model.

```{r response variable exploration}
#| echo: false
#| warning: false
#| message: false
#| label: fig-hist-time_spent_vigorous_exercise_7d
#| fig-cap: Histogram of time spent on vigorous exercise the past 7 days

hist(data_cleaned_1$time_spent_vigorous_exercise_7d,
     main='',
     xlab = 'time spent on vigorous exercise the past 7 days / min',
     ylab = 'no. of individuals',
     freq=TRUE, cex.main=1, las = 1
    )
```
## Interested explanatory variables

There are a total of 13 predictors of interest that is seemingly related to the time spent in vigorous exercise an exercising individual gets.  

### Variable 1: Age
This is a variable of interest because age is seemingly correlated to The age groups of respondents were obtained and they exist in bins that spans ages 18 years to 74 years old. 

- 3: 18-19 years old
- 4: 20-24 years old
- 5: 25-29 years old
- 6: 30-34 years old
- 7: 35-39 years old
- 8: 40-44 years old
- 9: 45-49 years old
- 10: 50-54 years old
- 11: 55-59 years old
- 12: 60-64 years old
- 13: 65-69 years old
- 14: 70-74 years old

From @fig-barplot-age, we can immediately see that most observations fall within age groups 30 to 34 years old (bin 6), and lesser observations fall within age groups 70-74 years old (bin 14).
```{r age predictor barplot}
#| echo: false
#| warning: false
#| message: false
#| label: fig-barplot-age
#| fig-cap: Histogram of time spent on vigorous exercise the past 7 days

# colnames(data_cleaned_1)
# 
# unique((data_cleaned_1 |>
#          arrange(age))$age)
#   
highest_freq_age <- data_cleaned_1 |>
  count(age) |>
  top_n(1, n) |>
  pull(age)

lowest_freq_age <- data_cleaned_1 |>
  count(age) |>
  top_n(-1, n) |>
  pull(age)

data_cleaned_1 |>
  mutate(group_col = case_when(age == highest_freq_age ~ 'indianred4',
                               age == lowest_freq_age ~ 'skyblue1',
                               .default = 'darkgrey')) |>
  ggplot()  +
  stat_count(aes(x=age, fill = group_col), show.legend=F) +
  scale_x_continuous(breaks = c(3:14)) +
  scale_fill_manual(values = c('indianred4' = 'indianred4', 
                               'skyblue1'= 'skyblue1', 
                               'darkgrey'='darkgrey')) +
  theme_minimal() +
  xlab('Age in years') +
  ylab('Number of individuals') +
  theme(panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank())
```

From @tbl-summarised_statistics_age and @fig-boxplot-age, we are able to see that the the median age bin belongs to age group 40-44 years old. We are able to see that there are no outlier values from @fig-boxplot-age, which means that the survey has obtained an acceptable number of respondents across all age bins. 
```{r age predictor summarised statistics}
#| echo: false
#| warning: false
#| message: false
#| label: tbl-summarised_statistics_age
#| tbl-cap: Summarised statistics of respondent ages
kable(data_cleaned_1 |>
  summarise(`Min.` = min(age),
            `1st Qu.` = quantile(age, 0.25),
            Median = median(age),
            `3rd Qu.` = quantile(age, 0.75),
            `Max.` = max(age)))
```
```{r age predictor boxplot}
#| echo: false
#| warning: false
#| message: false
#| label: fig-boxplot-age
#| fig-cap: Boxplot of respondent ages

ggplot(data_cleaned_1) +
  geom_boxplot(aes(y=age), 
               outlier.color = 'indianred4', 
               outlier.alpha=0.2) +
  theme_minimal() +
  scale_y_continuous(breaks = c(0:15)) +
  theme(axis.text.x = element_blank(),
        axis.ticks.x = element_blank(),
        panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank()) +
  ylab('respondent ages') +
  xlab('')
```

### Variable 2: Sex {#sec-sex_exploration}

Sex is a possible influential predictor for total time spent on vigorous activity. Historically, men are associated with exercise and involved in more labour intensive roles such as construction which involves heavy lifting. According to @womenExerciseWHO, women are less active than men by 5% since 2000. However, with the advent of female only establishments such as female gyms, and 32% increase in memberships at fitness and health clubs from 2010 to 2019, it would be interesting to see if the sex of an individual still affects the time spent on vigorous activites among physically active individuals.  

According to @fig-barplot-sex, there is roughly an equal proportion of sexes from our dataset, with slightly more males (6082 respondents) than females (5859 respondents). Since this was a health survey conducted over phone call, there is an equal chance of a respondent to be male or female, which is roughly reflected ing @fig-barplot-sex.
```{r sex predictor barplot}
#| echo: false
#| warning: false
#| message: false
#| label: fig-barplot-sex
#| fig-cap: Barplot of sex
data_cleaned_1 |>
  mutate(sex = factor(sex, levels = c(0,1), labels =c('Female','Male'))) |>
  ggplot()  +
  geom_bar(aes(x=sex, fill=sex), show.legend=F) +
  scale_fill_manual(values = c('Female' = 'indianred4',
                               'Male' = 'skyblue1')) +
  theme_minimal() +
  xlab('Individual\'s sex') +
  ylab('Number of individuals') +
  theme(panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank())

### obtain actual count of sex ###
# data_cleaned_1 |>
#   count(sex, name='no_of_respondents') |>
#   mutate(sex = ifelse(sex == 0, 'female', 'male'))
```

### Variable 3: Highest level of education

In 2023, @EducationAndActiveLifestyle has done a study to show that highest educational attainment may be a leading factor for physical activity. Therefore, it would be worth exploring the effects of highest levels of education with the time spent on vigorous activities among the Ontario residents.

According to @tbl-proportion_highest_educational_attainment, respondents who did not graduate secondary school account for only 5% of the population, and respondents who have at least a bachelor's degree account for 72% of the population. According to @fig-barplot_highest_educational_attainment, there seems to be class imbalance for this variable.

However, as seen from post-secondary institution enrollment data from @statisticaPostSecEnrollment, there has been an increase in total number of Canadians enrolled in post secondary education from 2000 to 2020. Accounting for population changes from 2000 [@statCanadaPopulation2000] to 2022 [@statCanadaPopulation2022], there is still a real increase in the number of real enrollments into post secondary education. Therefore, it is very possible that this is representative of the Ontario's population where majority of the population has at least post secondary education.

```{r proportion of respondents, group(highest_educational_attainment)}
#| echo: false
#| warning: false
#| message: false
#| label: tbl-proportion_highest_educational_attainment
#| tbl-cap: Proportion of respondents grouped by highest educational level
kable(data_cleaned_1 |>
  count(highest_educational_attainment, name = 'proportion_of_respondents') |>
  mutate(proportion_of_respondents = paste0(round(proportion_of_respondents/nrow(data_cleaned_1)*100,0),'%'),
         highest_educational_attainment = case_when(
           highest_educational_attainment == 1 ~ 'less than sec sch grad',
           highest_educational_attainment == 2 ~ 'sec sch grad',
           highest_educational_attainment == 3 ~ 'post sec certification and above',
           .default = '')))

# Obtain real increase in enrolment
# pop_2000 <- 30750000
# pop_2022 <- 39566248
# 
# rate_of_enrolment_population_2000 <- 1.44*1000000/pop_2000
# rate_of_enrolment_population_2020 <- 2.19*1000000/pop_2022 
# 
# c(rate_of_enrolment_population_2000, rate_of_enrolment_population_2020)
```

```{r}
#| echo: false
#| warning: false
#| message: false
#| label: fig-barplot_highest_educational_attainment
#| fig-cap: Barplot of highest_educational_attainment
data_cleaned_1 |>
  mutate(highest_educational_attainment = factor(highest_educational_attainment, levels = c(1,2,3), labels =c('less than sec sch grad','sec sch grad', 'university degree and above'))) |>
  ggplot()  +
  geom_bar(aes(x=highest_educational_attainment, fill=highest_educational_attainment), show.legend=F) +
  scale_fill_manual(values = c('less than sec sch grad' = 'orange1',
                               'sec sch grad' = 'indianred4',
                               'university degree and above' = 'skyblue1')) +
  theme_minimal() +
  xlab('Highest educational attainment') +
  ylab('Number of individuals') +
  theme(panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank())

```

### Variable 4: Health Region

Health region is a categorical variable which tells us the geographical location an individual belongs to defined by Provincial Ministries of Health. It could be possible that certain health regions have more funding that are projected towards increasing awareness towards having an active lifestyle. Therefore, it is worth exploring the relationship between health region and time spent on vigorous activities.


There are a total of 34 different health regions in the Ontario province. They are encoded using 5 digits. Kindly refer to the appendix (INSERT APPENDIX HERE PLEASE DONT FORGET) to refer to all the various health regions. @fig-map_health_region shows us the various health regions in Ontario. The blue regions shows us health regions for which lesser respondents belong to while red regions show us health regions for which more respondents belong to.

Highest occurring health regions

- 35951: City of Ottawa Health Unit
- 35953: Peel Regional Health Unit
- 35960: Simcoe Muskoka District Health Unit
- 35970: York Regional Health Unit
- 35995: City of Toronto Health Unit *(highest number of observations)

Lowest occurring health regions

- 35931: Elgin-St Thomas Health Unit
- 35935: Haliburton, Kawartha, Pine Ridge District Health Unit
- 35940: Chatham-Kent Health Unit
- 35942: Lambton Health Unit
- 35956: Porcupine Health Unit *(lowest number of observations)


```{r}
#| echo: false
#| warning: false
#| message: false
#| label: fig-map_health_region
#| fig-cap: Map of top five and bottom five occuring Ontario health 
library(tmap)

top_5_regions <- data_cleaned_1 |>
  count(health_region, name = 'count') |>
  top_n(5, count) |>
  arrange(health_region) |>
  pull(health_region) 

bottom_5_regions <- data_cleaned_1 |>
  count(health_region, name = 'count') |>
  top_n(-5, count) |>
  arrange(health_region) |>
  pull(health_region)

regions_to_keep <- c(top_5_regions, bottom_5_regions)

source("../scripts/08-health_region_map.R")

health_region_map
```

Overall, @fig-barplot_health_region shows us the actual number of observations belonging to the top five and bottom 5 occurring health regions. We can see that most respondents come from the City of Ontario Health Unit (Health_Region = 35995) and lesser respondents belong to Porcupine Health Unit (Health_Region = 35956).

```{r Health region map}
#| echo: false
#| warning: false
#| message: false
#| label: fig-barplot_health_region
#| fig-cap: Barplot of top and bottom five occuring health regions 

data_cleaned_1 |>
  # mutate(health_region = case_when(
  #   !(health_region %in% regions_to_keep) ~ 'other',
  #   .default = paste0(health_region, ''))) |>
  filter(health_region %in% regions_to_keep) |>
  count(health_region, name = 'count') |>
  mutate(group = ifelse(health_region %in% top_5_regions, 'top 5 health regions', 'bottom 5 health regions')) |>
  ggplot() +
  geom_bar(stat='identity', 
           aes(y = reorder(health_region, count),
               x = count,
               fill = group)) +
  theme_minimal() +
  scale_fill_manual(values = c('top 5 health regions' = 'indianred4', 
                               'bottom 5 health regions' = 'skyblue1')) +
  theme(legend.title = element_blank(),
        legend.position = 'bottom',
        legend.direction = 'vertical',
        panel.grid.major.y = element_blank(),
        panel.grid.minor.y = element_blank()) +
  guides(fill = guide_legend(reverse = T)) +
  ylab('Health Region') +
  xlab('Number of respondents') 
```

### Variable 5: Personal Income

In the dataset, personal income (INCDGPER) is a categorical variable that places an individuals annual income into a range of income values. Below summarises the encoded number and the corresponding meaning of each encoded number. All income values are measured per year.

- 1: No income or income loss
- 2: Less than $20,000 
- 3: \$20,000 to \$39,999
- 4: \$40,000 to \$59,999
- 5: \$60,000 to \$79,999
- 6: \$80,000 or more

According to @fig-barplot_personal_income, most of our respondents (25% of the sample) in Ontario are earning between \$20,000 to \$39,000 as part of their annual personal income. It is also worth mentioning that there are very few respondents who are not earning any income in that year. They account for less than 0.5% of the sample. In the 2018 annual wages report provided by @PersonalIncomeTaxFiling2018, the annual personal income reported from tax filing in Ontario that year was $39,510. Therefore, the sampling population's personal income data is representative of Ontario individuals.

```{r}
#| echo: false
#| warning: false
#| message: false
#| label: fig-barplot_personal_income
#| fig-cap: Barplot of personal income 

max_inc <- data_cleaned_1 |> 
  count(personal_income) |> 
  top_n(1, n) |>
  pull(personal_income)

min_inc <- data_cleaned_1 |> 
  count(personal_income) |> 
  top_n(-1, n) |>
  pull(personal_income)

data_cleaned_1 |>
  mutate(
    group_col = case_when(
      personal_income == max_inc ~ 'max',
       personal_income == min_inc ~ 'min',
      .default = 'others'),
    personal_income = factor(personal_income, 
                               levels = c(1:6), 
                               labels = c('No income or income loss',
                                          'Less than $20,000',
                                          '$20,000 to $39,999',
                                          '$40,000 to $59,999',
                                          '$60,000 to $79,999',
                                          '$80,000 or more'))) |>
  ggplot()  +
  geom_bar(aes(x=personal_income, fill=group_col), show.legend=F) +
  scale_fill_manual(values = c('max'= 'indianred4',
                               'min' = 'skyblue1',
                               'others' = 'grey')) +
  theme_minimal() +
  xlab('Annual Personal Income') +
  ylab('Number of respondents') +
  theme(panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        axis.text.x = element_text(angle=30, 
                                   hjust=1,
                                   vjust=1))
# obtain counts of each income bin
# data_cleaned_1 |>
#   count(personal_income) |>
#   mutate(prop_of_pop = paste0(round(n/nrow(data_cleaned_1)*100, 1), '%'))
```


### Variable 6: Frequency of alcohol consumption

This variable is a categorical variable with an implied order. 

- 1: Less than once a month
- 2: Once a month
- 3: two to three times a month
- 4: once a week
- 5: two to three times a week
- 6: four to six times a week
- 7: every day

From @fig-barplot_frequency_alcohol_consumption, we are able to see that most respondents from this dataset drink about 2-3 times per week (2973 respondents) as seen from the red bar. Also, we are seeing fewer respondents drinking about 4-6 times per week (887 respondents) as seen from the blue bar.
```{r Alcohol frequency bar graph}
#| echo: false
#| warning: false
#| message: false
#| label: fig-barplot_frequency_alcohol_consumption
#| fig-cap: Barplot of frequency of alcohol consumption
max_alc <- data_cleaned_1 |> 
  count(num_alc_drank_12m) |> 
  top_n(1, n) |>
  pull(num_alc_drank_12m)

min_alc <- data_cleaned_1 |> 
  count(num_alc_drank_12m) |> 
  top_n(-1, n) |>
  pull(num_alc_drank_12m)

data_cleaned_1 |>
  mutate(
    group_col = case_when(
      num_alc_drank_12m == max_alc ~ 'max',
       num_alc_drank_12m == min_alc ~ 'min',
      .default = 'others'),
    num_alc_drank_12m = factor(num_alc_drank_12m, 
                               levels = c(1:7), 
                               labels = c('<1 alc per month',
                                          '1 alc per month',
                                          '2-3 alc per month',
                                          '1 alc per week',
                                          '2-3 alc per week',
                                          '4-6 alc per week',
                                          'daily alc'))) |>
  ggplot()  +
  geom_bar(aes(x=num_alc_drank_12m, fill=group_col), show.legend=F) +
  scale_fill_manual(values = c('max'= 'indianred4',
                               'min' = 'skyblue1',
                               'others' = 'grey')) +
  theme_minimal() +
  xlab('Frequency of alcohol consumption') +
  ylab('Number of respondents') +
  theme(panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        axis.text.x = element_text(angle=30, 
                                   hjust=1,
                                   vjust=1.3))
```

### Variable 7: Illicit drug use the past 12 months

This is a binary variable which indicates whether an individual has used drugs in the past 12 months prior to the interview. Drugs include marijuana, hashish, cocaine, amphetamines, speed, methamphetamines, crystal meth, ecstasy, hallucinogens, and sniffing glue, gasoline or other solvents. If they have attempted any of these drugs, this variable would be flagged as '1' and '0' otherwise.

It would be interesting to see if drug consumption has an effect on exercising. @PhysicalActivityAndSubstanceAbuse exerts that individuals who are more active tend to have lower substance abuse, suggesting a correlation between these two. Having this variable would be interesting to explore the relationship of an individuals drug usage and their time spent on exercise. 

@fig-barplot_illicit_drug_use shows us the number of respondents who have (or haven't) consumed drugs 12 months prior to their interviews. We can see that majority of respondents have not consumed drugs in the given timeframe. However, from @tbl-illicit_drug_use, we can see that there are still a number of respondents who had consumed drugs in the past 12 months, particularly a fifth of the sampling population. According to @SubstanceUseAndAddiction, they estimate that about 21% of canadians, or 6 million people, will meet the criteria for substance use in their lifetime, and this is inclusive of alcohol and that there is a growing opiod crisis in Ontario. Therefore the obtained sample is somewhat representative of usage of drugs among the Ontario population. 
```{r Illicit drug use summary table}
#| echo: false
#| warning: false
#| message: false
#| label: tbl-illicit_drug_use
#| tbl-cap: Summary of illicit drug use the past 12 months

kable(data_cleaned_1 |>
  count(illicit_drug_use, name = 'num_of_respondents') |>
  mutate(prop_of_population = paste0(round(num_of_respondents/nrow(data_cleaned_1)*100,0),'%'),
         illicit_drug_use = ifelse(illicit_drug_use == 0, 
                                   'never consumed drugs',
                                   'consumed at least once')))
```

```{r Illicit drug use barplot}
#| echo: false
#| warning: false
#| message: false
#| label: fig-barplot_illicit_drug_use
#| fig-cap: Barplot of illicit drug use the past 12 months
data_cleaned_1 |>
  mutate(illicit_drug_use = factor(illicit_drug_use, levels = c(0,1), labels =c('Non-drug user','Drug user'))) |>
  ggplot()  +
  geom_bar(aes(x=illicit_drug_use, fill=illicit_drug_use), show.legend=F) +
  scale_fill_manual(values = c('Non-drug user' = 'indianred4',
                               'Drug user' = 'skyblue1')) +
  theme_minimal() +
  xlab('') +
  ylab('Number of respondents') +
  theme(panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank())
```


### Variable 8: Cigarette consumption

Respondents were asked whether they had smoked more than 100 cigarettes in their lifetimes. This variable is therefore binary, with '1' representing respondents that meet the critera and '0' otherwise. 

It is well known that excessive smoking has negative health impacts on individuals. A cross sectional study conducted by @SmokingAndPhysicalActiveness found that smokers are less likely to be physically active compared to non-smokers. Hence, it would be interesting to discover if there is an effect of smoking more than 100 cigarettes on the time spent on exercise. 

@fig-barplot-cigarettes shows us that within the sample, the visual difference between the number of respondents who smoked more than 100 cigarettes (blue column) and respondents who smoked lesser than 100 cigarettes are not that big. From @tbl-barplot-cigarettes, 57% of respondents have smoked less than 100 cigarettes while the remaining 43% of respondents smoked more than 100 cigarettes. As the classes in this variable is almost split half,

```{r cigarette barplot}
#| echo: false
#| warning: false
#| message: false
#| label: fig-barplot-cigarettes
#| fig-cap: Barplot of total cigarettes smoked in a respondent's lifetime

data_cleaned_1 |>
  mutate(smoked_hundred_cigarettes = factor(smoked_hundred_cigarettes, levels = c(0,1), labels =c('Less than 100 cigarettes','More than 100 cigarettes'))) |>
  ggplot()  +
  geom_bar(aes(x=smoked_hundred_cigarettes, fill=smoked_hundred_cigarettes), show.legend=F) +
  scale_fill_manual(values = c('Less than 100 cigarettes' = 'indianred4',
                               'More than 100 cigarettes' = 'skyblue1')) +
  theme_minimal() +
  xlab('') +
  ylab('Number of respondents') +
  theme(panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank())
```


@fig-pyrmaid-cigarettes shows us cigarette consumption by age bins among out sample population. As respondent age increases from the first bin (18 to 19 year old) to the fourth bin (30 to 34 year old), we can see the number of respondents who have smoked more than 100 cigarettes in their lifetime increased from less than 125 respondents to more than 500 respondents (about 3 times more respondents between the two age groups).
```{r cigarette consumption pyramid figure}
#| echo: false
#| warning: false
#| message: false
#| label: fig-pyrmaid-cigarettes
#| tbl-cap: Pyramid of cigarettes consumption in respondent's lifetime by age groups

data_cleaned_1 |>
      group_by(age) |>
  count(smoked_hundred_cigarettes, name = 'num_of_respondents') |>
  mutate(prop_of_population = paste0(round(num_of_respondents/nrow(data_cleaned_1)*100,0),'%'),
         smoked_hundred_cigarettes = ifelse(smoked_hundred_cigarettes == 0, 
                                   'Less than 100 cigarettes',
                                   'More than 100 cigarettes'),
         dummy = ifelse(smoked_hundred_cigarettes == 'More than 100 cigarettes', num_of_respondents, -num_of_respondents)) |>
  ggplot() +
  geom_col(aes(x=age, y=dummy, fill=smoked_hundred_cigarettes)) +
  scale_x_continuous(breaks = c(3:14), 
                     labels = c('18 - 19 y/o',
                                '20 - 24 y/0',
                                '25 - 29 y/o',
                                '30 - 34 y/o',
                                '35 - 39 y/o',
                                '40 - 44 y/o',
                                '45 - 49 y/o',
                                '50 - 54 y/o',
                                '55 - 59 y/o',
                                '60 - 64 y/o',
                                '65 - 69 y/o',
                                '70 - 74 y/o')) +
  scale_y_continuous(breaks = seq(-750,750, 250), labels = abs) +
  scale_fill_manual(values = c('Less than 100 cigarettes' = 'indianred4',
                           'More than 100 cigarettes' = 'skyblue1')) +
  xlab('') +
  ylab('Number of respondents') +
  coord_flip() +
  theme_minimal() +
  theme(legend.title = element_blank(),
        panel.grid.major.y = element_blank(),
        panel.grid.minor.y = element_blank())

### FOR PERSONAL USE, DELETE LATER
# colnames(analysis_data_w_dummies)
# analysis_data |>
#   select(health_region) |>
#   distinct() |>
#   arrange(health_region)
# length(colnames(analysis_data_w_dummies |>
#   select(health_region_35927:health_region_35995)))
# data_cleaned_1 |>
#   count(smoked_hundred_cigarettes)
```

# Model

The goal of our model is to explore which factors affect time spent on physical activities. Therefore a simple exploratory linear regression would be the chosen 
modelling algorithm to determine it. A full model where our response (time_spent_on_physical_activities) would be fitted on all our interested variables outlined in @sec-data-interestedvariables (INSERT THE SECTION  HERE LATER PLEASE DONT FORGET). Background details and diagnostics are included in [Appendix -@sec-model-details].

## Model set-up

Let $k$ be the individual from CCHS dataset. Define $y_k$ as the time spent on physical activities for individual $k$. Then $Age_k$, $Sex_k$, $Educ_k$ and $Alc_k$ represents individual i's age, sex, highest educational attainment, and frequency of alcohol consumption the past 12 months respectively. Also, $Drug_k$ and $Cigar_k$ would be indicator explanatory variables derived from the binary variables in our dataset representing if individual k had consumed drugs in the past 12 months and if he/she has smoked 100 cigars in their lifetime respectively. Finally, $HealthRegion_k=35953$ and $HealthRegion_k=35970$ are also indicator explanatory variables derived from the categorical variable health_region in our dataset, which represents if individual k belongs to Health Region 35953 (Peel Regional Health Unit) and if he/she belongs to Health Region 35970 (York Regional Health Unit). Note that the reference with respect to Health Region would be individuals that are not in both health region 35953 and 35970.

Therefore the final model would be... 

\begin{align*} 
y_k  &= \beta_0 + \beta_1Age_k + \beta_2Sex_k + \beta_3Educ_k + \beta_4Alc_k +\beta_5I*(Drug_k) + \beta_6I*(Cigar_k) + \\ 
     & \quad\: \beta_7I*(HealthRegion_k=35953) + \beta_8*I(HealthRegion_k=35970) + \epsilon_k
\end{align*}

\begin{align} 
y_k|\mu_k, \sigma^2 &\sim \mbox{Normal}(\mu_k, \sigma^2) \tag{1} \\
\mu_k &= \beta_0 + \beta_1Age_k + \beta_2Sex_k + \beta_3Educ_k + \beta_4Alc_k + \tag{2} \\
      & \quad\: \beta_5I*(Drug_k) + \beta_6I*(Cigar_k) + \notag \\ 
      & \quad\: \beta_7I*(HealthRegion_k=35953) + \notag \\
      & \quad\: \beta_8*I(HealthRegion_k=35970) \notag \\
\epsilon_k &\sim \mbox{Normal}(0, \sigma^2) \tag{3}  
\end{align}

We run the model in R [@citeR] using the `stats` package which is a base library offered by the R Core Team, specifically the `lm()` function to create our simple linear regression. The default parameters of the `lm()` function would be used. 


### Model justification

Initially, we fitted a full model containing every variable of interest. Since health region is a categorical variable with no implied order, To handle health region, we will be creating dummy variables for each health region, specifically $I*(HealthRegion_k=i)$ for $i \in {health\_region}$, and the reference chosen for health region would be the health_region = 35926 (The District of Algoma HU). We define $Income_k$ to be the the personal income of individual k in our dataset. 

Then, for $8 \leq c \leq 40$ and $i \in {health\_region}$, our original full model was defined as... 

\begin{align*} 
y_k  &= \beta_0 + \beta_1Age_k + \beta_2Sex_k + \beta_3Educ_k + \beta_4Income_k +\beta_5Alc_k +\beta_6I*(Drug_k) +  \\ 
     & \quad\: \beta_7I*(Cigar_k) + \beta_cI*(HealthRegion=i) + \epsilon_k
\end{align*}

We then conducted model reduction using backward feature elimination using Bayesian Information Criterion (BIC) as our scoring metric to obtain the least number of predictors that minimises the residual errors from the reduced model. This model reduction was performed using `stats` package from the @citeR as well. The resulting BIC value was obtained from the `lme4` package [@citationBIC]. 

# Results

The final model with our estimated coefficients are as follows

\begin{align*} 
y_k  &= 5.84 - 0.03Age_k + 0.23 Sex_k - 0.08Educ_k + 0.04Alc_k + 0.15I*(Drug_k) +  \\ 
     & \quad\: 0.12I*(Cigar_k) + \beta_cI*(HealthRegion=i) + \epsilon_k
\end{align*}

Our results are summarized in @tbl-modelresults.

```{r}
#| echo: false
#| eval: true
#| warning: false
#| message: false

```

```{r}
#| echo: false
#| eval: true
#| label: tbl-modelresults
#| tbl-cap: "Linear model of time spent on physically taxing activities based on explanatory variables"
#| warning: false

final_model <-
  readRDS(file = ("../models/final_model.rds"))

modelsummary::modelsummary(
  list(
    "Time spent on physical activity" = final_model
  )
)
```


\newpage

# Discussion

## Males are more likely to engage in physical activities {#sec-men_physical_activites}
For the explanatory variable `sex`, the corresponding coefficient from the fitted linear model is 0.232. This means that if an individual is a male, this increases the time spent on physical activities by 26%. While we were expecting increase in the overall engagement in physical activity among women as explained in @sec-sex_exploration, men are still more likely to engage in physical activities than women. In 2018, Global News Canada reported that 31% of women and 25% of men have insufficient physical activity [@citationMenVsWomenExercise]. Therefore, our linear regression model discovery was not surprising.

In fact, in a study published in the Journal of American College of Cardiology, they discovered that women who were physically active would experience greater health benefits than men who were also physically active [@citationWomenSurviveBetterExercise]. Therefore, this means that more can be done to address the gender gap in the engagement of physical activities. 


## Ontario residents who have smoked before might be more likely to engage in physical activities.

From elementary school, Ontario students are exposed to health education where schools would educate about the harms of smoking. It is well known that smoking has negative effect's on an individual's health. Therefore it is unexpected that the linear regression model showed a positive coefficient for the indicator variable for 'having smoked 100 cigarettes' in an individual's lifetime.

The linear model is telling us that if an individual has smoked 100 cigarettes in their lifetime, they are 13% more likely to spend more time being physically active than an individual who has not smoked more than 100 cigarettes in the same timeframe. While it may seem contradicting to what we believe, there may be merit to this value.

A team from the school of Public Health Sciences at University of Waterloo had explored patterns and trends for tobbaco use in canada. What they found was that 70% of Canadians who had smoked before have quit as of 2020 @citationSmokingPatternsWaterlooUniversity. While smoking may have been affected an individual's physical capabilities, it could have also increased awareness regarding the importance of their health. Since most canadians who had a history of smoking had quit smoking, it is very possible that they have greater health conscious. Coupled with increased government support for programs with the sole purpose of increasing physical activeness in Ontario [@citationGovernmentSupportExercise], it is no longer surprising why individuals who smoked 100 cigarettes in their lifetime are on average 13% more likely to engage in physical activities.

Please don't use these as sub-heading labels - change them to be what your point actually is.

## Third discussion point

## Possible increase in stimulant use (about drugs)

## Weaknesses and next steps

Weaknesses and next steps should also be included.

\newpage

\appendix

# Appendix {-}


# Additional data details

# Model details {#sec-model-details}

## Posterior predictive check

In @fig-ppcheckandposteriorvsprior-1 we implement a posterior predictive check. This shows...

In @fig-ppcheckandposteriorvsprior-2 we compare the posterior with the prior. This shows... 

```{r}
#| eval: true
#| echo: false
#| message: false
#| warning: false
#| label: fig-ppcheckandposteriorvsprior
#| layout-ncol: 2
#| fig-cap: "Examining how the model fits, and is affected by, the data"
#| fig-subcap: ["Posterior prediction check", "Comparing the posterior with the prior"]

```

## Diagnostics

@fig-stanareyouokay-1 is a trace plot. It shows... This suggests...

@fig-stanareyouokay-2 is a Rhat plot. It shows... This suggests...

```{r}
#| echo: false
#| eval: true
#| message: false
#| warning: false
#| label: fig-stanareyouokay
#| fig-cap: "Checking the convergence of the MCMC algorithm"
#| fig-subcap: ["Trace plot", "Rhat plot"]
#| layout-ncol: 2
```



\newpage


# References


