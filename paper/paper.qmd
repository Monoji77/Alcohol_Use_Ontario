---
title: "Men and past smokers from Ontario are potentially more physically active than women and non-smokers"
subtitle: "Physical activity is discovered to be strongly associated with gender, smoking habits, and drug consumption."
author: 
  - Chris Yong Hong Sen
thanks: "Code and data are available at: [https://github.com/Monoji77/Alcohol_Use_Ontario](https://github.com/Monoji77/Alcohol_Use_Ontario)."
date: today
date-format: long
abstract: "This study explores factors influencing physical activity levels in Ontario, focusing on demographics and substance abuse. Our findings reveal that women engage in less physical activity than men, while individuals who have smoked in the past and those consuming stimulant-related drugs are more likely to be physically active. Additionally, age, highest educational attainment, and health region also play significant roles in determining physical activity levels. These insights highlight the complex interplay of gender, lifestyle behaviors, and sociodemographic factors, providing valuable information for designing targeted public health interventions to promote physical activity."
format: 
  pdf:
    fig-pos: H
number-sections: true
bibliography: references.bib
---

```{r importing libraries}
#| include: false
#| warning: false
#| message: false

library(tidyverse) # for manipulation and visualisation
library(knitr) # displaying tables
library(arrow) # reading parquet file
library(tmap) # displaying maps
library(lme4) # reporting BIC values
```


# Introduction

Physical activity is a cornerstone of public health, yet participation rates remain suboptimal across various populations in Ontario. This is especially concerning as physical inactivity is a leading contributor to chronic diseases such as heart disease, diabetes, and mental health disorders. Factors such as age, sex, educational attainment, alcohol consumption, smoking habits, and regional disparities in health access play a critical role in shaping physical activity behaviors. Understanding these factors and their complex interactions is crucial for developing targeted interventions that can improve health outcomes and reduce health inequalities in Ontario.

Recent studies suggest that certain demographic groups, such as older adults and individuals with lower educational levels, are more likely to experience barriers to physical activity. At the same time, alcohol consumption and smoking are associated with lower physical activity levels [@citationBaumanPhysicalActivity]. However, limited research has explored how these factors specifically interact in Ontario, a province with diverse populations and health regions. As the burden of chronic disease grows, addressing these disparities becomes even more urgent [@citationWarburtonPhysicalActivity].

This study seeks to address the gaps in understanding by exploring how age, sex, educational attainment, alcohol consumption, smoking, and health regions influence physical activity patterns in Ontario. By examining these relationships, we aim to provide actionable insights that can inform public health policies and interventions tailored to the needs of specific population groups. Our findings will be pivotal in developing strategies to increase physical activity participation and improve health equity in Ontario.

The estimand of this paper would be the actual effect of socio-demographic factors, substance abuse, and health factors on how much time is spent on strenuous activities among individuals in Ontario who engage in physical activities.

The remainder of this paper is structured as follows. @sec-data would provide a sense of the chosen Computing in the Humanities and Social Sciences dataset as well as data exploration of interested variables. @sec-Model goes into the details of the linear regression model fitted on the predictors of interest variables, for which its results would be showcased in @sec-results. @sec-discussion would then interpret the results of the fitted linear regression model, which includes the limitations of the paper. In [Appendix -@sec-diagnostic_checks], it contains diagnostic checks for all models considered. Finally, [Appendix -@sec-survey_methodology] goes through the background and surveying methodology of the CCHS dataset.


Overall, this paper was generated using R programming language [@citeR]. Reading of raw data and data manipulation was performed using `Tidyverse` package [@citeTidyverse] and parquet file handling was done using functions in `arrow` package [@citeArrow]. Generation of maps was done using functions in `tmap` package [@citationTmap]. Any other visual plots were using `ggplot`-related functions in Tidyverse [@citeTidyverse] and tables were generated using `kable` function in `knitr` package [@citeKnitR]. 


# Data {#sec-data}

## Context of dataset

The dataset chosen is obtained from Computing in the Humanities and Social Sciences/CHASS at the University of Toronto [@SDA_CHASS], specifically the Canadian Community Health Survey (CCHS) annual component 2017-2018 which was collected by @StatisticsOfCanada. The goal of the CCHS survey is to collect comprehensive and reliable health-related data on the Canadian population to support health surveillance, research, and program evaluation. It aims to provide timely, accessible, and flexible data for monitoring health trends, studying small populations and rare characteristics, and addressing emerging health issues, ultimately helping improve the health and well-being of Canadians. 

Other datasets explored include sources from the World Health Organisation and ParticipACTION. World Health Organisation provides aggregated data informing certain indicators of interest such as obesity levels and alcohol consumption. This can be found in the data section for Canada[@OtherSource1]. Also, ParticipACTION provides key statistics regarding the proportion of the adult population in Canada meeting the national guidelines of 150 minutes of moderate to vigorous physical activities, as well as how sedentary Canadians are [@OtherSource2]. However, the availability of raw individual-level data is absent from these sources. Although the aggregated data gives us a sense of general Canadian health, we are not able to focus our attention on the Ontario population. The dataset chosen from the Canadian Community Health Survey (CCHS) annual component is ideal as it contains individual-level data, where we are able to obtain the province the respondents are from in order to obtain our desired target population.

## Original Dataset

The dataset provides 113,290 individual responses from Canadians throughout the country. Surveys were conducted to collect health-related data from respondents. The relevant data collected includes...

- Demographics and Identity: 
Age, gender, marital status, citizenship, Aboriginal identity, visible minority status, immigrant status, language (mother tongue, spoken at home, first official), sexual orientation.

- Health Status and Conditions:
Chronic diseases, neurological conditions, mental health indicators, perceived physical and mental health, pain, discomfort, activity limitations, and disabilities.


- Health Behaviors and Lifestyle:
Smoking, drinking, cannabis use, physical activity, helmet use, dietary practices (e.g., fruits, vegetables), breastfeeding, and BMI.

- Health Care Access and Utilization:
Contact with health professionals, access to health services, immunizations (e.g., flu shots), cancer screenings (e.g., mammograms, pap smears), waiting times, and satisfaction with services.

- Socio-Economic Factors: 
Educational attainment, work activity, household income, living arrangements, presence of children in the household, food insecurity.

- Life Quality and Perceptions:
Life satisfaction, life stress, sense of belonging, health-adjusted life expectancy.

- Specialized Health Indicators:
Two-week disability days, quality and ratings of health care services, functional health status.

- Specific Population Measures:
Aboriginal group, immigrant duration, visible minority, minority health disparities.

- Geographic and Household Data:
Geographic location, number of persons or households, household demographics.

This dataset is highly suitable for determining both quantitative factors such as  c qualitative factors.


## Measurement {#sec-measurement}

Our goal is to explore the actual effect of socio-demographic factors, substance abuse, and health factors on how much time is spent on physical activities among active individuals in Ontario. The instrument of measurement would be surveys. Through the cross-sectional survey conducted by CCHS, we are able to get the number of hours spent on physical activities per individual, our response variable.

According to the questionnaire, respondents were asked in a phone survey to indicate whether they had engaged in any strenuous activity that lasted at least 10 minutes and made them sweat and breathe a little harder in the past 7 days. Afterward, they were asked to indicate the total time spent on those activities. To address the concern of recall bias where an individual may not recall the specific timing in engaging with physical activity, surveyors sectioned physical activity into commuting, sports, work, and volunteering. Then within each section, surveyors asked which day (Monday to Sunday) in the past week had they engaged in such activities that made them sweat and breathe a little harder. By doing so, the activities individuals did during the past week would be anchored on the days of the week. Following this would be for the respondents to indicate the total number of hours they engaged in each section of physical activities for the past 7 days.

In addition, the explanatory variables we are interested in were also obtained in the same survey. 

For socio-demographic factors possibly affecting time spent on physical activities, the surveyors asked the respondent for their age (DHH_AGE) from 0 years old to 121 years old), sex (DHH_SEX) being either male or female, personal income obtained from tax forms submitted to the Canada Revenue Agency upon consent from the respondent, geographical health region (ADM_Q037) that was provided by respondents when they agreed to the phone survey, and highest educational attainment (EHG2_04) ranging from less than high school diploma to master's degree and above. 

For substance abuse, respondents were asked how frequently they consumed alcoholic drinks in the past 12 months (ALC_Q015), ranging from less than once per month to every day. Surveyors also asked respondents about the usage of drugs including one-time marijuana or hashish in the past 12 months (DRG_Q005 to DRG_Q075), and whether they have smoked hundred cigarettes in the past 12 months (SMK_Q020). The last 2 questions allowed respondents to indicate a simple yes or no flag to express their answer.

For health factors, questions were asked to determine an individual's body mass index ranging from underweight to obese, and perceived life/work stress ranging from not at all stressful to extremely stressful. Additionally, surveyors asked respondents if they have mood disorders (E.g. depression, bipolar, mania), to which respondents replied with a simple yes or no. 

Overall, each entry obtained by respondents assigns quantitative values to each factor and the the response for which we can explore subsequently using linear regression to determine which factors have greater influence on the time spent on physical activities amongst active individuals.


## Response variable: Time spent on physical activity in the past 7 days

From the CCHS dataset, we look at paadvmva variable. This variable is continuous with values ranging from 0 to 9902 representing the number of minutes spent on physical activity in the past 7 days. For easier readability, the variable will be renamed as $time\_spent\_vigorous\_exercise\_7d$.  As explained in section @sec-measurement, this variable measures the time spent on any activities lasting more than 10 minutes that makes an individual sweat more than they normally would. This would include individuals undertaking laborious employment or volunteering efforts, or it could simply include individuals who do cardio and/or strength training.    

By using this variable, we are assuming that the routine of an individual from the past 7 days is indicative of their general routine beyond the past 7 days. This variable may not account for individuals who only began a physical routine involving sweat within the past 7 days and were sedentary before, which may not be helpful if included in subsequent model fitting.

Since we are interested in individuals who are already engaging in strenuous activities, we can filter $time\_spent\_vigorous\_exercise\_7d$ to exclude 0. After removing such entries, we obtain the following summary statistics as shown in @tbl-summarised_statistics_time_spent_vigorous_exercise_7d. The median time spent on physical activities the past 7 days would be 300 minutes, which averages out to 43 minutes per day. 

```{r}
#| echo: false
#| warning: false
#| message: false
#| label: tbl-summarised_statistics_time_spent_vigorous_exercise_7d
#| tbl-cap: Summarised statistics for time spent on physical activities in the past 7 days

original_data <- read_parquet("../data/02-analysis_data/analysis_data.parquet") 

data_cleaned_1 <- original_data |>
  filter(time_spent_vigorous_exercise_7d != 0) 

# data_cleaned_1 |>
#   top_n(10, time_spent_vigorous_exercise_7d) |>
#   select(time_spent_vigorous_exercise_7d) |>
#   arrange(desc(time_spent_vigorous_exercise_7d))

response_var_summarised_data <- data_cleaned_1 |>
  summarise(`Min.` = min(time_spent_vigorous_exercise_7d),
            `1st Qu.` = quantile(time_spent_vigorous_exercise_7d, 0.25),
            Median = median(time_spent_vigorous_exercise_7d),
            `3rd Qu.` = quantile(time_spent_vigorous_exercise_7d, 0.75),
            `Max.` = max(time_spent_vigorous_exercise_7d))

kable(response_var_summarised_data)

###############
# function: obtain outlier observations 
#
#
###############

# first_quartile <- quantile(data_cleaned_1$time_spent_vigorous_exercise_7d, 0.25)
# third_quartile <- quantile(data_cleaned_1$time_spent_vigorous_exercise_7d, 0.75)
# IQR <- third_quartile - first_quartile
# outlier_observation <- data_cleaned_1 |>
#   filter(time_spent_vigorous_exercise_7d < (first_quartile - 1.5*IQR) | 
#            time_spent_vigorous_exercise_7d > (third_quartile + 1.5*IQR))
# nrow(outlier_observation)
# round(nrow(outlier_observation)/nrow(data_cleaned_1) * 100,0)
```

Interestingly, the maximum time spent on physical activities in the past 7 days was 9902 minutes, and this averages to 1415 minutes per day, which is equivalent to 23.5 hours in a day. This is very unlikely as this suggests that an individual is constantly engaging in physical strenuous activity without sleeping. Logically, this suggests the possibility of outlier values. By observing @fig-boxplot_time_spent_vigorous_exercise_7d, there are many outlier observations for this variable. Roughly 10% of the observed data are considered outliers as they fall outside 1.5 times the interquartile range from the 25% and 75% quartile values. We would be performing log transformation on our response variable. The motivation for this is detailed in [Appendix -@sec-transform-response].


```{r}
#| echo: false
#| warning: false
#| message: false
#| label: fig-boxplot_time_spent_vigorous_exercise_7d
#| fig-cap: Summary statistic of time spent on physical activities in the past 7 days

data_cleaned_1 |> 
  ggplot(aes(y=time_spent_vigorous_exercise_7d, x='')) +
  geom_boxplot(outlier.color = 'indianred4', 
               outlier.alpha=0.2,
               width = 0.5) +
  geom_jitter(alpha = 0.01, width=0.15) +
  theme_minimal() +
  theme(axis.text.x = element_blank(),
        axis.ticks.x = element_blank()) +
  ylab('') +
  xlab('Boxplot of time spent on physical activities in the past 7 days')
```

Subsequently, we would have to remove observations that are very unlikely as they do not represent the general population and could skew the distribution of time spent on physical activities.

By observing @fig-hist-time_spent_vigorous_exercise_7d, we obtain a severely right-skewed response where most observations lie between 0 to 500 minutes. For the building of linear models in subsequent sections of the paper, this would not be ideal as linear regression assumes a normal distribution of the response variable, suggesting that a transformation would be required to fit a linear regression model.

```{r response variable exploration}
#| echo: false
#| warning: false
#| message: false
#| label: fig-hist-time_spent_vigorous_exercise_7d
#| fig-cap: Time spent on physical activities the past 7 days

hist(data_cleaned_1$time_spent_vigorous_exercise_7d,
     main='',
     xlab = 'no. of minutes',
     ylab = 'no. of individuals',
     freq=TRUE, cex.main=1, las = 1
    )
```
## Interested explanatory variables {#sec-interested_variables}

There are a total of 13 predictors of interest that are seemingly related to the time spent on physical activities by an individual in Ontario.  

### Variable 1: Age
This is a variable of interest because age is seemingly correlated to time spent on physical activities. It is well known that the younger schooling population has more time and physical capacity to exercise than a working adult. In the International Journal of Behavioral Nutrition and Physical Activity, @citationUofExerciseAndAge discovered that younger individuals were exercising more than their older counterparts. 

The age groups of respondents were obtained and they exist in bins that span ages 18 years to 74 years old. 

- 3: 18-19 years old
- 4: 20-24 years old
- 5: 25-29 years old
- 6: 30-34 years old
- 7: 35-39 years old
- 8: 40-44 years old
- 9: 45-49 years old
- 10: 50-54 years old
- 11: 55-59 years old
- 12: 60-64 years old
- 13: 65-69 years old
- 14: 70-74 years old

From @fig-barplot-age, we can immediately see that most observations fall within age groups 30 to 34 years old (bin 6), and lesser observations fall within age groups 70-74 years old (bin 14).
```{r age predictor barplot}
#| echo: false
#| warning: false
#| message: false
#| label: fig-barplot-age
#| fig-cap: Time spent on physical activities the past 7 days

# colnames(data_cleaned_1)
# 
# unique((data_cleaned_1 |>
#          arrange(age))$age)
#   
highest_freq_age <- data_cleaned_1 |>
  count(age) |>
  top_n(1, n) |>
  pull(age)

lowest_freq_age <- data_cleaned_1 |>
  count(age) |>
  top_n(-1, n) |>
  pull(age)

data_cleaned_1 |>
  mutate(group_col = case_when(age == highest_freq_age ~ 'indianred4',
                               age == lowest_freq_age ~ 'skyblue1',
                               .default = 'darkgrey')) |>
  ggplot()  +
  stat_count(aes(x=age, fill = group_col), show.legend=F) +
  scale_x_continuous(breaks = c(3:14)) +
  scale_fill_manual(values = c('indianred4' = 'indianred4', 
                               'skyblue1'= 'skyblue1', 
                               'darkgrey'='darkgrey')) +
  theme_minimal() +
  xlab('Age in years') +
  ylab('Number of individuals') +
  theme(panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank())
```

From @tbl-summarised_statistics_age and @fig-boxplot-age, we are able to see that the median age bin belongs to the age group 40-44 years old. We are able to see that there are no outlier values from @fig-boxplot-age, which means that the survey has obtained an acceptable number of respondents across all age bins. 
```{r age predictor summarised statistics}
#| echo: false
#| warning: false
#| message: false
#| label: tbl-summarised_statistics_age
#| tbl-cap: Summarised statistics of respondent ages

age_data_summarised_statistics <- data_cleaned_1 |>
  summarise(`Min.` = min(age),
            `1st Qu.` = quantile(age, 0.25),
            Median = median(age),
            `3rd Qu.` = quantile(age, 0.75),
            `Max.` = max(age))

kable(age_data_summarised_statistics)
```


```{r age predictor boxplot}
#| echo: false
#| warning: false
#| message: false
#| label: fig-boxplot-age
#| fig-cap: Summary statistics of respondent ages

data_cleaned_1 |>
  ggplot(aes(y=age, x='')) +
  geom_boxplot(outlier.color = 'indianred4', 
               outlier.alpha=0.2) +
  geom_jitter(aes(col = age),
              alpha=0.1, 
              width = 0.15) +
  theme_minimal() +
  scale_y_continuous(breaks = c(0:15)) +
  scale_color_viridis_c(name = 'age bin') +
  theme(axis.text.x = element_blank(),
        axis.ticks.x = element_blank(),
        panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank()) +
  ylab('respondent age bin') +
  xlab('')
```

### Variable 2: Sex {#sec-sex_exploration}

Sex is a possible influential predictor for total time spent on physical activity. Historically, men are associated with exercise and involved in more labour-intensive roles such as construction which involves heavy lifting. According to @womenExerciseWHO, women have been less active than men by 5% since 2000. However, with the advent of female-only establishments such as female gyms, and a 32% increase in memberships at fitness and health clubs from 2010 to 2019, it would be interesting to see if the sex of an individual still affects the time spent on physical activities among physically active individuals.  

According to @fig-barplot-sex, there is roughly an equal proportion of sexes from our dataset, with slightly more males (6082 respondents) than females (5859 respondents). Since this was a health survey conducted over a phone call, there is an equal chance of a respondent being male or female, which is roughly reflected in @fig-barplot-sex.
```{r sex predictor barplot}
#| echo: false
#| warning: false
#| message: false
#| label: fig-barplot-sex
#| fig-cap: Frequency of sex variable
data_cleaned_1 |>
  mutate(sex = factor(sex, levels = c(0,1), labels =c('Female','Male'))) |>
  ggplot()  +
  geom_bar(aes(x=sex, fill=sex), show.legend=F) +
  scale_fill_manual(values = c('Female' = 'indianred4',
                               'Male' = 'skyblue1')) +
  theme_minimal() +
  xlab('Individual\'s sex') +
  ylab('Number of individuals') +
  theme(panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank())

### obtain actual count of sex ###
# data_cleaned_1 |>
#   count(sex, name='no_of_respondents') |>
#   mutate(sex = ifelse(sex == 0, 'female', 'male'))
```

### Variable 3: Highest level of education

In 2023, @EducationAndActiveLifestyle did a study to show that the highest educational attainment may be a leading factor for physical activity. Therefore, it would be worth exploring the effects of the highest levels of education on the time spent on physical activities among Ontario residents.

According to @tbl-proportion_highest_educational_attainment, respondents who did not graduate secondary school account for only 5% of the population, and respondents who have at least a bachelor's degree account for 72% of the population. According to @fig-barplot_highest_educational_attainment, there seems to be a class imbalance for this variable.

However, as seen from post-secondary institution enrollment data from @statisticaPostSecEnrollment, there has been an increase in the total number of Canadians enrolled in post-secondary education from 2000 to 2020. Accounting for population changes from 2000 [@statCanadaPopulation2000] to 2022 [@statCanadaPopulation2022], there is still a real increase in the number of real enrollments in post-secondary education. Therefore, it is very possible that this is representative of Ontario's population where the majority of the population has at least post-secondary education.

```{r proportion of respondents, group(highest_educational_attainment)}
#| echo: false
#| warning: false
#| message: false
#| label: tbl-proportion_highest_educational_attainment
#| tbl-cap: Proportion of respondents grouped by highest educational level

proportion_highest_educ_table <- data_cleaned_1 |>
  count(highest_educational_attainment, name = 'proportion_of_respondents') |>
  mutate(proportion_of_respondents = paste0(round(proportion_of_respondents/nrow(data_cleaned_1)*100,0),'%'),
         highest_educational_attainment = case_when(
           highest_educational_attainment == 1 ~ 'less than sec sch grad',
           highest_educational_attainment == 2 ~ 'sec sch grad',
           highest_educational_attainment == 3 ~ 'post sec certification and above',
           .default = '')) 

kable(proportion_highest_educ_table)

# Obtain real increase in enrolment
# pop_2000 <- 30750000
# pop_2022 <- 39566248
# 
# rate_of_enrolment_population_2000 <- 1.44*1000000/pop_2000
# rate_of_enrolment_population_2020 <- 2.19*1000000/pop_2022 
# 
# c(rate_of_enrolment_population_2000, rate_of_enrolment_population_2020)
```

```{r}
#| echo: false
#| warning: false
#| message: false
#| label: fig-barplot_highest_educational_attainment
#| fig-cap: Frequency of highest_educational_attainment variable
data_cleaned_1 |>
  mutate(highest_educational_attainment = factor(highest_educational_attainment, levels = c(1,2,3), labels =c('less than sec sch grad','sec sch grad', 'university degree and above'))) |>
  ggplot()  +
  geom_bar(aes(x=highest_educational_attainment, fill=highest_educational_attainment), show.legend=F) +
  scale_fill_manual(values = c('less than sec sch grad' = 'orange1',
                               'sec sch grad' = 'indianred4',
                               'university degree and above' = 'skyblue1')) +
  theme_minimal() +
  xlab('Highest educational attainment') +
  ylab('Number of individuals') +
  theme(panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank())

```

### Variable 4: Health Region

Health region is a categorical variable that tells us the geographical location an individual belongs to defined by Provincial Ministries of Health (as detailed by documentation provided by CHASS). It could be possible that certain health regions have more funding that are projected towards increasing awareness towards having an active lifestyle. Therefore, it is worth exploring the relationship between health region and time spent on physical activities.


There are a total of 34 different health regions in the Ontario province. They are encoded using 5 digits. @fig-map_health_region shows us the various health regions in Ontario. The blue regions show us health regions to which fewer respondents belong while the red regions show us health regions to which more respondents belong.

Highest occurring health regions

- 35951: City of Ottawa Health Unit
- 35953: Peel Regional Health Unit
- 35960: Simcoe Muskoka District Health Unit
- 35970: York Regional Health Unit
- 35995: City of Toronto Health Unit *(highest number of observations)

Lowest occurring health regions

- 35931: Elgin-St Thomas Health Unit
- 35935: Haliburton, Kawartha, Pine Ridge District Health Unit
- 35940: Chatham-Kent Health Unit
- 35942: Lambton Health Unit
- 35956: Porcupine Health Unit *(lowest number of observations)

By using a GIS-focused library in R called tmap [@citationTmap], we are able to generate the map shown in @fig-map_health_region.

```{r health region map}
#| echo: false
#| warning: false
#| message: false
#| label: fig-map_health_region
#| fig-cap: Map of top five and bottom five occuring Ontario health 

top_5_regions <- data_cleaned_1 |>
  count(health_region, name = 'count') |>
  top_n(5, count) |>
  arrange(health_region) |>
  pull(health_region) 

bottom_5_regions <- data_cleaned_1 |>
  count(health_region, name = 'count') |>
  top_n(-5, count) |>
  arrange(health_region) |>
  pull(health_region)

regions_to_keep <- c(top_5_regions, bottom_5_regions)

source("../scripts/05-health_region_map.R")

health_region_map
```

Overall, @fig-barplot_health_region shows us the actual number of observations belonging to the top five and bottom 5 occurring health regions. We can see that most respondents come from the City of Ontario Health Unit (Health_Region = 35995) and fewer respondents belong to the Porcupine Health Unit (Health_Region = 35956).

```{r Health region map}
#| echo: false
#| warning: false
#| message: false
#| label: fig-barplot_health_region
#| fig-cap: Frequency of top and bottom five occuring health regions 

data_cleaned_1 |>
  # mutate(health_region = case_when(
  #   !(health_region %in% regions_to_keep) ~ 'other',
  #   .default = paste0(health_region, ''))) |>
  filter(health_region %in% regions_to_keep) |>
  count(health_region, name = 'count') |>
  mutate(group = ifelse(health_region %in% top_5_regions, 'top 5 health regions', 'bottom 5 health regions')) |>
  ggplot() +
  geom_bar(stat='identity', 
           aes(y = reorder(health_region, count),
               x = count,
               fill = group)) +
  theme_minimal() +
  scale_fill_manual(values = c('top 5 health regions' = 'indianred4', 
                               'bottom 5 health regions' = 'skyblue1')) +
  theme(legend.title = element_blank(),
        legend.position = 'bottom',
        legend.direction = 'vertical',
        panel.grid.major.y = element_blank(),
        panel.grid.minor.y = element_blank()) +
  guides(fill = guide_legend(reverse = T)) +
  ylab('Health Region') +
  xlab('Number of respondents') 
```

### Variable 5: Personal Income

In the dataset, personal income (INCDGPER) is a categorical variable that places an individual's annual income into a range of income values. Below summarises the encoded number and the corresponding meaning of each encoded number. All income values are measured per year.

- 1: No income or income loss
- 2: Less than \$20,000 
- 3: \$20,000 to \$39,999
- 4: \$40,000 to \$59,999
- 5: \$60,000 to \$79,999
- 6: \$80,000 or more

According to @fig-barplot_personal_income, most of our respondents (25% of the sample) in Ontario are earning between \$20,000 to \$39,000 as part of their annual personal income. It is also worth mentioning that there are very few respondents who are not earning any income in that year. They account for less than 0.5% of the sample. In the 2018 annual wages report provided by @PersonalIncomeTaxFiling2018, the annual personal income reported from tax filing in Ontario that year was \$39,510. Therefore, the sampling population's personal income data is representative of Ontario individuals.

```{r}
#| echo: false
#| warning: false
#| message: false
#| label: fig-barplot_personal_income
#| fig-cap: Frequency of personal income 

max_inc <- data_cleaned_1 |> 
  count(personal_income) |> 
  top_n(1, n) |>
  pull(personal_income)

min_inc <- data_cleaned_1 |> 
  count(personal_income) |> 
  top_n(-1, n) |>
  pull(personal_income)

data_cleaned_1 |>
  mutate(
    group_col = case_when(
      personal_income == max_inc ~ 'max',
       personal_income == min_inc ~ 'min',
      .default = 'others'),
    personal_income = factor(personal_income, 
                               levels = c(1:6), 
                               labels = c('No income or income loss',
                                          'Less than $20,000',
                                          '$20,000 to $39,999',
                                          '$40,000 to $59,999',
                                          '$60,000 to $79,999',
                                          '$80,000 or more'))) |>
  ggplot()  +
  geom_bar(aes(x=personal_income, fill=group_col), show.legend=F) +
  scale_fill_manual(values = c('max'= 'indianred4',
                               'min' = 'skyblue1',
                               'others' = 'grey')) +
  theme_minimal() +
  xlab('Annual Personal Income') +
  ylab('Number of respondents') +
  theme(panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        axis.text.x = element_text(angle=30, 
                                   hjust=1,
                                   vjust=1))
# obtain counts of each income bin
# data_cleaned_1 |>
#   count(personal_income) |>
#   mutate(prop_of_pop = paste0(round(n/nrow(data_cleaned_1)*100, 1), '%'))
```


### Variable 6: Frequency of alcohol consumption

This variable is a categorical variable with an implied order. 

- 1: Less than once a month
- 2: Once a month
- 3: two to three times a month
- 4: once a week
- 5: two to three times a week
- 6: four to six times a week
- 7: every day

From @fig-barplot_frequency_alcohol_consumption, we can see that most respondents from this dataset drink about 2-3 times per week (2973 respondents) as seen from the red bar. Also, we are seeing fewer respondents drinking about 4-6 times per week (887 respondents) as seen from the blue bar.
```{r Alcohol frequency bar graph}
#| echo: false
#| warning: false
#| message: false
#| label: fig-barplot_frequency_alcohol_consumption
#| fig-cap: Frequency of alcohol consumption
max_alc <- data_cleaned_1 |> 
  count(num_alc_drank_12m) |> 
  top_n(1, n) |>
  pull(num_alc_drank_12m)

min_alc <- data_cleaned_1 |> 
  count(num_alc_drank_12m) |> 
  top_n(-1, n) |>
  pull(num_alc_drank_12m)

data_cleaned_1 |>
  mutate(
    group_col = case_when(
      num_alc_drank_12m == max_alc ~ 'max',
       num_alc_drank_12m == min_alc ~ 'min',
      .default = 'others'),
    num_alc_drank_12m = factor(num_alc_drank_12m, 
                               levels = c(1:7), 
                               labels = c('<1 alc per month',
                                          '1 alc per month',
                                          '2-3 alc per month',
                                          '1 alc per week',
                                          '2-3 alc per week',
                                          '4-6 alc per week',
                                          'daily alc'))) |>
  ggplot()  +
  geom_bar(aes(x=num_alc_drank_12m, fill=group_col), show.legend=F) +
  scale_fill_manual(values = c('max'= 'indianred4',
                               'min' = 'skyblue1',
                               'others' = 'grey')) +
  theme_minimal() +
  xlab('Frequency of alcohol consumption') +
  ylab('Number of respondents') +
  theme(panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        axis.text.x = element_text(angle=30, 
                                   hjust=1,
                                   vjust=1.3))
```

### Variable 7: Illicit drug use the past 12 months {#sec-drug_exploration}

This is a binary variable that indicates whether an individual has used drugs in the past 12 months prior to the interview. Drugs include marijuana, hashish, cocaine, amphetamines, speed, methamphetamine, crystal meth, ecstasy, hallucinogens, and sniffing glue, gasoline or other solvents. If they have attempted any of these drugs, this variable would be flagged as '1' and '0' otherwise.

It would be interesting to see if drug consumption affects physical activity. @PhysicalActivityAndSubstanceAbuse exerts that individuals who are more active tend to have lower substance abuse, suggesting a correlation between these two. Having this variable would be interesting to explore the relationship between an individual's drug usage and their time spent on physical activities. 

@fig-barplot_illicit_drug_use shows us the number of respondents who have (or haven't) consumed drugs 12 months before their interviews. We can see that the majority of respondents have not consumed drugs in the given timeframe. However, from @tbl-illicit_drug_use, we can see that there are still several respondents who had consumed drugs in the past 12 months, particularly a fifth of the sampling population. According to @SubstanceUseAndAddiction, they estimate that about 21% of Canadians, or 6 million people, will meet the criteria for substance use in their lifetime, and this is inclusive of alcohol and there is a growing opioid crisis in Ontario. Therefore the obtained sample is somewhat representative of the usage of drugs among the Ontario population. 
```{r Illicit drug use summary table}
#| echo: false
#| warning: false
#| message: false
#| label: tbl-illicit_drug_use
#| tbl-cap: Summary of illicit drug use the past 12 months

drug_use_proportion_table <- data_cleaned_1 |>
  count(illicit_drug_use, name = 'num_of_respondents') |>
  mutate(prop_of_population = paste0(round(num_of_respondents/nrow(data_cleaned_1)*100,0),'%'),
         illicit_drug_use = ifelse(illicit_drug_use == 0, 
                                   'never consumed drugs',
                                   'consumed at least once'))

kable(drug_use_proportion_table)
```

```{r Illicit drug use barplot}
#| echo: false
#| warning: false
#| message: false
#| label: fig-barplot_illicit_drug_use
#| fig-cap: Illicit drug use the past 12 months
data_cleaned_1 |>
  mutate(illicit_drug_use = factor(illicit_drug_use, levels = c(0,1), labels =c('Non-drug user','Drug user'))) |>
  ggplot()  +
  geom_bar(aes(x=illicit_drug_use, fill=illicit_drug_use), show.legend=F) +
  scale_fill_manual(values = c('Non-drug user' = 'indianred4',
                               'Drug user' = 'skyblue1')) +
  theme_minimal() +
  xlab('') +
  ylab('Number of respondents') +
  theme(panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank())
```


### Variable 8: Cigarette consumption

Respondents were asked whether they had smoked more than 100 cigarettes in their lifetimes. This variable is therefore binary, with '1' representing respondents that meet the criteria and '0' otherwise. 

It is well known that excessive smoking has negative health impacts on individuals. A cross-sectional study conducted by @SmokingAndPhysicalActiveness found that smokers are less likely to be physically active compared to non-smokers. Hence, it would be interesting to discover if there is an effect of smoking more than 100 cigarettes on the time spent on physical activities. 

@fig-barplot-cigarettes shows us that within the sample, the visual difference between the number of respondents who smoked more than 100 cigarettes (blue column) and respondents who smoked less than 100 cigarettes is not that big. Specifically, 57% of respondents have smoked less than 100 cigarettes while the remaining 43% of respondents smoked more than 100 cigarettes. As the classes in this variable are almost split in half.

```{r cigarette barplot}
#| echo: false
#| warning: false
#| message: false
#| label: fig-barplot-cigarettes
#| fig-cap: Barplot of total cigarettes smoked in a respondent's lifetime

data_cleaned_1 |>
  mutate(smoked_hundred_cigarettes = factor(smoked_hundred_cigarettes, levels = c(0,1), labels =c('Less than 100 cigarettes','More than 100 cigarettes'))) |>
  ggplot()  +
  geom_bar(aes(x=smoked_hundred_cigarettes, fill=smoked_hundred_cigarettes), show.legend=F) +
  scale_fill_manual(values = c('Less than 100 cigarettes' = 'indianred4',
                               'More than 100 cigarettes' = 'skyblue1')) +
  theme_minimal() +
  xlab('') +
  ylab('Number of respondents') +
  theme(panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank())
```


@fig-pyrmaid-cigarettes shows us cigarette consumption by age bins among our sample population. As respondent age increases from the first bin (18 to 19 years old) to the fourth bin (30 to 34 years old), we can see the number of respondents who have smoked more than 100 cigarettes in their lifetime increased from less than 125 respondents to more than 500 respondents (about 3 times more respondents between the two age groups).
```{r cigarette consumption pyramid figure}
#| echo: false
#| warning: false
#| message: false
#| label: fig-pyrmaid-cigarettes
#| fig-cap: Cigarette consumption in respondent's lifetime by age groups

data_cleaned_1 |>
      group_by(age) |>
  count(smoked_hundred_cigarettes, name = 'num_of_respondents') |>
  mutate(prop_of_population = paste0(round(num_of_respondents/nrow(data_cleaned_1)*100,0),'%'),
         smoked_hundred_cigarettes = ifelse(smoked_hundred_cigarettes == 0, 
                                   'Less than 100 cigarettes',
                                   'More than 100 cigarettes'),
         dummy = ifelse(smoked_hundred_cigarettes == 'More than 100 cigarettes', num_of_respondents, -num_of_respondents)) |>
  ggplot() +
  geom_col(aes(x=age, y=dummy, fill=smoked_hundred_cigarettes)) +
  scale_x_continuous(breaks = c(3:14), 
                     labels = c('18 - 19 y/o',
                                '20 - 24 y/0',
                                '25 - 29 y/o',
                                '30 - 34 y/o',
                                '35 - 39 y/o',
                                '40 - 44 y/o',
                                '45 - 49 y/o',
                                '50 - 54 y/o',
                                '55 - 59 y/o',
                                '60 - 64 y/o',
                                '65 - 69 y/o',
                                '70 - 74 y/o')) +
  scale_y_continuous(breaks = seq(-750,750, 250), labels = abs) +
  scale_fill_manual(values = c('Less than 100 cigarettes' = 'indianred4',
                           'More than 100 cigarettes' = 'skyblue1')) +
  xlab('') +
  ylab('Number of respondents') +
  coord_flip() +
  theme_minimal() +
  theme(legend.title = element_blank(),
        panel.grid.major.y = element_blank(),
        panel.grid.minor.y = element_blank())

### FOR PERSONAL USE, DELETE LATER
# colnames(analysis_data_w_dummies)
# analysis_data |>
#   select(health_region) |>
#   distinct() |>
#   arrange(health_region)
# length(colnames(analysis_data_w_dummies |>
#   select(health_region_35927:health_region_35995)))
# data_cleaned_1 |>
#   count(smoked_hundred_cigarettes)
```

# Model {#sec-Model}

The goal of our model is to explore which factors affect time spent on physical activities. Therefore a simple exploratory linear regression would be the chosen 
modelling algorithm to determine it. A full model where our response $time\_spent\_vigorous\_exercise\_7d$ would be fitted on all our interested variables outlined in @sec-interested_variables.

## Model set-up

Let $k$ be the individual from the CCHS dataset. Define $y_k$ as the time spent on physical activities for individual $k$. Then $Age_k$, $Sex_k$, $Educ_k$, and $Alc_k$ represent individual i's age, sex, highest educational attainment, and frequency of alcohol consumption in the past 12 months respectively. Also, $Drug_k$ and $Cigar_k$ would be indicator explanatory variables derived from the binary variables in our dataset representing if individual k had consumed drugs in the past 12 months and if he/she has smoked 100 cigars in their lifetime respectively. Finally, $HealthRegion_k=35953$ and $HealthRegion_k=35970$ are also indicator explanatory variables derived from the categorical variable health_region in our dataset, which represents if individual k belongs to Health Region 35953 (Peel Regional Health Unit) and if he/she belongs to Health Region 35970 (York Regional Health Unit). Note that the reference concerning Health Region would be individuals that are not in both Health Region 35953 and 35970.

Therefore the final model would be... 

\begin{align*} 
\ln(y_k)  &= \beta_0 + \beta_1Age_k + \beta_2Sex_k + \beta_3Educ_k + \beta_4Alc_k +\beta_5I*(Drug_k) + \beta_6I*(Cigar_k) + \\ 
     & \quad\: \beta_7I*(HealthRegion_k=35953) + \beta_8*I(HealthRegion_k=35970) + \epsilon_k
\end{align*}

\begin{align} 
\ln(y_k)|\mu_k, \sigma^2 &\sim \mbox{Normal}(\mu_k, \sigma^2) \tag{1} \\
\mu_k &= \beta_0 + \beta_1Age_k + \beta_2Sex_k + \beta_3Educ_k + \beta_4Alc_k + \tag{2} \\
      & \quad\: \beta_5I*(Drug_k) + \beta_6I*(Cigar_k) + \notag \\ 
      & \quad\: \beta_7I*(HealthRegion_k=35953) + \notag \\
      & \quad\: \beta_8*I(HealthRegion_k=35970) \notag \\
\epsilon_k &\sim \mbox{Normal}(0, \sigma^2) \tag{3}  
\end{align}

We run the model in R [@citeR] using the `stats` package which is a base library offered by the R Core Team, specifically the `lm()` function to create our simple linear regression. The default parameters of the `lm()` function would be used. 


### Model justification {#sec-model_justification}

Initially, we fitted a full model containing every variable of interest. Since health region is a categorical variable with no implied order, To handle health region, we will be creating dummy variables for each health region, specifically $I*(HealthRegion_k=i)$ for $i \in {health\_region}$, and the reference chosen for health region would be the health_region = 35926 (The District of Algoma HU). We define $Income_k$ to be the personal income of individual k in our dataset. 

Then, for $8 \leq c \leq 40$ and $i \in {health\_region}$, our original full model was defined as... 

\begin{align*} 
\ln(y_k) &= \beta_0 + \beta_1Age_k + \beta_2Sex_k + \beta_3Educ_k + \beta_4Income_k +\beta_5Alc_k +\beta_6I*(Drug_k) +  \\ 
     & \quad\: \beta_7I*(Cigar_k) + \beta_cI*(HealthRegion=i) + \epsilon_k
\end{align*}

We then conducted model reduction using backward feature elimination using the Bayesian Information Criterion (BIC) as our scoring metric to obtain the least number of predictors that minimizes the residual errors from the reduced model. This model reduction was performed using `stats` package from the @citeR as well. The resulting BIC value was obtained from the `lme4` package [@citationBIC]. 

@tbl-BIC_values shows us the BIC values for both the full model and the reduced model. After removing certain explanatory variables, the BIC score has decreased, indicating that the reduced model has stronger explanatory power while having a less complex model. Therefore, the reduced model is chosen from the original full model.

```{r}
#| echo: false
#| warning: false
#| message: false
#| label: tbl-BIC_values
#| tbl-cap: Table of BIC values for original and final model
 
original_model <- 
  readRDS(file = ("../models/original_model.rds"))

# parse in final model
final_model <- readRDS('../models/final_model.rds')


BIC_tibble <- as_tibble(
  list(`Model` = c('Original full model', 'Final reduced model'),
  `BIC value` = c(BIC(original_model), BIC(final_model))
  )) |>
  mutate(`BIC value` = round(`BIC value`, 0))

kable(BIC_tibble)
```


# Results {#sec-results}

The final model with our estimated coefficients are as follows

\begin{align*} 
\ln(y_k)  &= 5.84 - 0.03Age_k + 0.23 Sex_k - 0.08Educ_k + 0.04Alc_k + 0.15I*(Drug_k) +  \\ 
     & \quad\: 0.12I*(Cigar_k) + \beta_cI*(HealthRegion=i) + \epsilon_k
\end{align*}

Overall, the individual t-test for our predictors was found to be below our set threshold of 95% alpha. The confidence interval for each predictor is listed in @tbl-confidence_interval_lmmodel shown below.

```{r confidence interval for linear model}
#| echo: false
#| warning: false
#| message: false
#| label: tbl-confidence_interval_lmmodel
#| tbl-cap: Confidence Interval of linear model

# obtain variable names in lmmodel
variables <- variable.names(final_model)

# create confidence interval table to display 
conf_interval_table <- as_tibble(confint(final_model)) |>
  mutate(`Variable Name` = variables, .before = '2.5 %') |>
  mutate_if(is.numeric, list(~round(.,2)))

# diaply confidence interval table
kable(conf_interval_table)
```

Our results are summarized in @tbl-modelresults.

```{r summary of linear model}
#| echo: false
#| eval: true
#| label: tbl-modelresults
#| tbl-cap: "Linear model of time spent on physically taxing activities based on explanatory variables"
#| warning: false

final_model <-
  readRDS(file = ("../models/final_model.rds"))

modelsummary::modelsummary(
  list(
    "Log(Time_spent_on_physical_activity)" = final_model
  )
)
```


\newpage

# Discussion {#sec-discussion}

## Males are more likely to engage in physical activities{#sec-men_physical_activities}

According to @fig-physical_activity_by_sex, we can observe that amongst active individuals, men spend (on average) more time on physical activity than women. In particular, according to our sample men spend on average 639 minutes a week on physical activities while women spend on average 437 minutes a week on physical activities. 

```{r bar plot of results - sex}
#| echo: false
#| eval: true
#| label: fig-physical_activity_by_sex
#| fig-cap: Average time spent on physical activity by sex
#| warning: false

options(scipen=999)
exercise_sex_data <- data_cleaned_1 |>
  group_by(sex) |>
  summarise(
         avg_physical_activity_time_spent = mean(time_spent_vigorous_exercise_7d)) |>
  mutate(sex = ifelse(sex == 0, 'Female', 'Male')) |>
  ungroup()

exercise_sex_data|>
  ggplot() +
  geom_bar(mapping = aes(x=sex, 
                         y=avg_physical_activity_time_spent,
                         fill=sex), 
           stat = 'identity') +
  scale_fill_manual(values = c('Female' = 'indianred4',
                               'Male' = 'skyblue1')) +
  xlab('') +
  ylab('Average time spent on physical activity / min') +
  theme_minimal() +
  theme(panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank())
```

For the explanatory variable `sex`, the corresponding coefficient from the fitted linear model is 0.232. This means that if an individual is a male, this increases the time spent on physical activities by 26%. While we were expecting an increase in the overall engagement in physical activity among women as explained in @sec-sex_exploration, men are still more likely to engage in physical activities than women. In 2018, Global News Canada reported that 31% of women and 25% of men have insufficient physical activity [@citationMenVsWomenExercise]. Therefore, our linear regression model discovery was not surprising.

In fact, in a study published in the Journal of American College of Cardiology, they discovered that physically active women would experience greater health benefits than men who were also physically active [@citationWomenSurviveBetterExercise]. Therefore, this means that more can be done to address the gender gap in the engagement of physical activities. 


## Ontario residents who have smoked before might be more likely to engage in physical activities.

From elementary school, Ontario students are exposed to health education where schools would educate about the harms of smoking. It is well known that smoking has negative effects on an individual's health. Therefore it is unexpected that the linear regression model showed a positive coefficient for the indicator variable for 'having smoked 100 cigarettes' in an individual's lifetime.

The linear model tells us that if an individual has smoked 100 cigarettes in their lifetime, they are 13% more likely to spend more time being physically active than an individual who has not smoked more than 100 cigarettes in the same time frame. While it may seem contradicting to what we believe, there may be merit to this value. From @fig-physical_activity_by_smoking_status, we can see that individuals who had smoked 100 cigarettes in their lifetime spent more time on physical activity than individuals who have not smoked 100 cigarettes. In particular, our data shows that on average, individuals who smoked 100 cigarettes spend 618 minutes on physical activities in a week while those who didn't spend only 418 minutes on physical activities.

```{r bar plot of results - smoking status}
#| echo: false
#| eval: true
#| label: fig-physical_activity_by_smoking_status
#| fig-cap: Average time spent on physical activity by smoking status
#| warning: false

cigarette_sex_data <- data_cleaned_1 |>
  group_by(smoked_hundred_cigarettes) |>
  summarise(
         avg_physical_activity_time_spent = mean(time_spent_vigorous_exercise_7d)) |>
  mutate(smoked_hundred_cigarettes = ifelse(smoked_hundred_cigarettes == 0, 'Non smoker/\nlight smoker', 'Past heavy smoker/\nCurrent heavy smoker'),
         smoked_hundred_cigarettes = factor(smoked_hundred_cigarettes, levels = c('Non smoker/\nlight smoker', 'Past heavy smoker/\nCurrent heavy smoker'))) |>
  ungroup()

cigarette_sex_data |>
  ggplot() +
  geom_bar(mapping = aes(x=smoked_hundred_cigarettes, 
                         y=avg_physical_activity_time_spent,
                         fill=smoked_hundred_cigarettes), 
           stat = 'identity',
           show.legend = F) +
  scale_fill_manual(values = c('Non smoker/\nlight smoker' = 'indianred4',
                               'Past heavy smoker/\nCurrent heavy smoker' = 'skyblue1')) +
  xlab('') +
  ylab('Average time spent on physical activity/ min') +
  theme_minimal() +
  theme(panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank()) 
```

A team from the School of Public Health Sciences at the University of Waterloo explored patterns and trends for tobacco use in Canada. What they found was that 70% of Canadians who had smoked before have quit as of 2020 @citationSmokingPatternsWaterlooUniversity. While smoking may have affected an individual's physical capabilities, it could have also increased awareness regarding the importance of their health. Since most Canadians who have a history of smoking have quit smoking, it is very possible that they have greater health consciousness. Coupled with increased government support for programs with the sole purpose of increasing physical activeness in Ontario [@citationGovernmentSupportExercise], it is no longer surprising why individuals who smoked 100 cigarettes in their lifetime are on average 13% more likely to engage in physical activities.

## Possible increase in stimulant use

According to the model, the coefficient for illicit drug use is a positive value. This means that if an individual from Ontario has consumed drugs listed in @sec-drug_exploration, they would spend on average 17% more time on physical activities. This is also another surprising finding since we have also discussed in @sec-drug_exploration that there is a negative correlation between drug use and physical activeness, but our findings for our Ontario population suggest a positive correlation. From @fig-physical_activity_by_illicit_drug_use, we can see that individuals who consumed drugs listed in @sec-drug_exploration in their lifetime spent more time on physical activity than individuals who have not consumed drugs. In particular, our data shows that on average, individuals who are drug abusers spend 670 minutes on physical activities in a week while those who don't spend only 503 minutes on physical activities.

```{r bar plot of results - illicit drug use}
#| echo: false
#| eval: true
#| label: fig-physical_activity_by_illicit_drug_use
#| fig-cap: Average time spent on physical activity by illicit drug use"
#| warning: false

drug_sex_data <- data_cleaned_1 |>
  group_by(illicit_drug_use) |>
  summarise(
         avg_physical_activity_time_spent = mean(time_spent_vigorous_exercise_7d)) |>
  mutate(illicit_drug_use = ifelse(illicit_drug_use == 0, 'Non-drug users', 'Drug users'),
         illicit_drug_use = factor(illicit_drug_use, levels = c('Non-drug users', 'Drug users'))) |>
  ungroup()

drug_sex_data |>
  ggplot() +
  geom_bar(mapping = aes(x=illicit_drug_use, 
                         y=avg_physical_activity_time_spent,
                         fill=illicit_drug_use), 
           stat = 'identity',
           show.legend = F) +
  scale_fill_manual(values = c('Non-drug users' = 'indianred4',
                               'Drug users' = 'skyblue1')) +
  xlab('') +
  ylab('Average time spent on physical activity/ min') +
  theme_minimal() +
  theme(panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank()) 
```

Of the listed drugs, amphetamine and methamphetamine were identified as well. According to @citationDrugsAndActiveLifestyle, they mentioned that the use of meth (short for methamphetamine) leads to increased concentrations of dopamine, which is a mood enhancer. This is coupled with the increase in body movement. Likewise, in a study conducted by Indiana University [@citationAmphetamineandExercise], they found that the use of Amphetamine masks fatigue, allowing individuals to exercise longer. This shows that it is possible that the inclusion of these drugs could have explained the surprising increase in time spent on physical activities despite the expectation that an individual who abuses drugs would have lower exercise.  

The inclusion of these drugs in the survey results in aggregation bias as many drugs which may have varying effects on physical activity were clumped into this single inclusion variable. This bias could explain the positive coefficient seen from our model. However, this is just a hypothesis and an experiment would need to be conducted to explore if this finding is true, where we obtain a sample of drug users who consumed amphetamine and methamphetamine and drug users who did not consume the two drugs.

## Weaknesses 

Self-reported bias is a common limitation in health data collection, particularly when examining behaviors like physical activity, alcohol consumption, and smoking. Participants may overestimate or underestimate their activities due to memory recall issues, social desirability bias, or personal perceptions of what constitutes "healthy" behavior. For example, individuals might inflate their reported exercise levels or downplay unhealthy habits like smoking. Such inaccuracies can introduce systematic error, leading to biased estimates of associations and potentially undermining the validity of the study's conclusions. Mitigating this requires complementary objective measures, such as wearable activity trackers or biomarkers.

Furthermore, the intent of aggregating data to protect an individual's privacy in census data collection caused certain variables to be too over-generalized, and have limited categorizations for meaningful exploration. For instance, the highest educational attainment variable only has 3 bins, not having attained a secondary certification, having attained secondary certification, and having post-secondary certification. The first category includes both individuals that went to school and individuals that never went to school. Also, the last category includes individuals obtaining post-secondary diplomas, bachelor's, master's, and PhD degrees. Each category that was otherwise aggregated to fit the three categories during dataset collection might have had a different effect on the response variable, resulting in aggregation bias and potentially losing important information.

Also, age has inconsistent bins, particularly for 18 to 19 year olds and every other bin, therefore this would result in fewer individuals that belong to the 18 to 19 year old bin. This would lead to biased medians when conducting summary statistics and undersampling due to a smaller inclusion criterion for this specific bin, resulting in decreased precision when conducting statistical tests like chi-square test.

\newpage

\appendix

# Appendix {-}

# Diagnostic Checks {#sec-diagnostic_checks}
## Motivation to transform response variable for linear regression model {#sec-transform-response}

Our response variable was log-transformed to fulfill diagnostic checks for the linear regression model. Observe the change in the qq plot of the fitted linear regression model before our response ($time\_spent\_on\_vigorous\_exercise\_7d$) was log-transformed and after it was log-transformed. From the left plot of @fig-diagnostic_plot_qq, we can see that values of standardized residuals are a lot larger than expected at higher quantile values. This suggests that the distribution of the residuals is severely right-skewed. This contradicts the assumption of normality of residuals, which would make our linear regression model unreliable. 

From the right plot of @fig-diagnostic_plot_qq, after we transform our response using the natural logarithm function ($ln$), we can see that most of the residuals lie on the y=x line in the qq plot, suggesting that the sampling distribution is approximately normal. 

```{r qq plot}
#| echo: false
#| eval: true
#| label: fig-diagnostic_plot_qq
#| fig-cap: "Diagnostic plot: QQ Plot"
#| warning: false

not_transformed_model <-
  readRDS(file = ("../models/original_model_not_transformed.rds"))

par(mfrow = c(1,2))
plot(not_transformed_model,2, col=adjustcolor('black', alpha=0.2), sub='')
title(main='not transformed')
p2_1 <- plot(original_model,2, col=adjustcolor('black', alpha=0.2), sub='')
title(main='log-transformed')
```

Now, we observe the change in the scale location plot of the fitted linear regression model before our response ($time\_spent\_on\_vigorous\_exercise\_7d$) was log-transformed and after it was log-transformed. From the left plot of @fig-diagnostic_plot_scale_location, we can see a weak but visible trend that as the fitted values increase, so does the square root of the standardized residuals. This suggests that the residuals are not randomly distributed, which goes against the assumption of linear regression that residuals are independent of each other. Furthermore, the mean red line is not horizontally flat. This suggests a positive trend. This tells us that the variance of the residuals is increasing, therefore implying that our residuals do not satisfy the homoscedasticity assumption of linear regression, which would lead to an unreliable linear regression model.

From the right plot of @fig-diagnostic_plot_scale_location, we can see that the standardized residuals are randomly scattered across the plot across all fitted values. This suggests that residuals are independent from each other. Furthermore, the mean red line is (almost) horizontally flat, which suggests that the variance of residuals across all fitted values is constant. Therefore, the homoscedasticity assumption for linear regression is also satisfied, allowing us to interpret the coefficient estimates of our fitted linear model with greater reliability.

```{r scale location plot}
#| echo: false
#| eval: true
#| label: fig-diagnostic_plot_scale_location
#| fig-cap: "Diagnostic plot: Scale location"
#| warning: false

par(mfrow = c(1,2))
plot(not_transformed_model,3, sub='')
title(main='not transformed')
plot(original_model,3, sub='')
title(main='log-transformed')
```

By performing log transformation of my response, we have satisfied the linear regression assumptions, allowing us to interpret from a reliable linear regression model, therefore explaining the need to transform our response variable in @sec-Model. This would also allow us to perform model reduction outlined in @sec-model_justification.

## Diagnostic check for final linear model after BIC

The final linear model was obtained after performing backward feature elimination using the BIC score as the criterion. This section shows that the final model satisfies linear regression assumptions.

@fig-diagnostic_plot_qq_final_model shows us that the values of standardized residuals are approximately equal to the theoretical quantiles, which suggests that the residuals are normally distributed. 
```{r}
#| echo: false
#| eval: true
#| label: fig-diagnostic_plot_qq_final_model
#| fig-cap: "Diagnostic plot: QQ Plot"
#| warning: false
plot(final_model,2, sub='')
```
From @fig-diagnostic_plot_scale_location_final_model, we can see that the standardised residuals are randomly scattered across the scale location plot, which suggests that residuals are independant from each other. Furthermore, the mean red line is (almost) horizontal which suggests that the variance of residuals is constant across all fitted values. This means that the residuals obtained from the final model satisfy the homoscedasticity assumption in linear regression.
```{r}
#| echo: false
#| eval: true
#| label: fig-diagnostic_plot_scale_location_final_model
#| fig-cap: "Diagnostic plot: Scale location"
#| warning: false
plot(final_model,3, sub='')
```

Overall, since the residual assumptions in linear regression are satisfied, we are able to use the coefficient estimates obtained from our final fitted linear model to gain insights into the relationship between our predictors and the response as discussed in @sec-discussion.

# Survey: Canadian Community Health Survey (CCHS) Annual component {#sec-survey_methodology}

\newpage

## CCHS Background

The purpose of CCHS is to provide cross-sectional estimates of factors related to different health determinants in Canada. The use case for the Canadian health dataset is non-exhaustive and many have used it for the betterment of Canada. In the Department of Sociology and Social Work, University of Toronto, researchers have used the weight and weight perception data from the 2017-2018 CCHS to predict adolescents' mental health, and they were able to find out that normal weighted girls are not immune from poor mental health arising from poor weight perceptions, hence urging specialists in the mental health field to increase support for these girls that have not been receiving enough avenues [@citationUofTCCHS]. The Canadian Partnership Against Cancer also uses CCHS data to assess the severity of cervical cancer among Canadians, streamlining their cancer screening process as a result and urging the country to focus resources on addressing inequalities in access to cervical cancer prevention and treatment options between Indigenous communities and poor regions [@citationCanadianPartnership2; @citationCanadianPartnership1]. The one thing that ties many of the health-related studies arising from the use of CCHS studies is to address underrepresented communities in Canada.

With the purpose of unifying data across health sources, the Statistics of Canada has begun conducting surveys yearly since 2007. Since 2015, there has been a redesign to the survey methodology that is used for the dataset that was used in this paper.

## CCHS Target Population

Their target population covers individuals aged 12 and above living in all ten provinces of Canada. The target population excludes the following...

- individuals living on reserves, more commonly known as Indigenous populations with their own governance within Canada
- full-time servicemen in the Canadian Armed Forces
- youths aged 12 to 17 residing in foster homes
- individuals residing in jail, nursing homes, mental health institutions, and shelters
- individuals in the Quebec health region of Nunavik and Terres-Cries-de-la-Baie-James

According to CCHS, they account for less than 3% of the population.

## CCHS Sampling Frame

The sampling frame for the Canadian Community Health Survey (CCHS) consists of two distinct components based on the target population. For the adult population (18 years and older), the sampling frame is derived from an area frame used by the Canadian Labour Force Survey (LFS). This area frame includes all primary sampling units (PSUs), which are geographic clusters of dwellings within health regions across Canada. For the youth population (12 to 17 years old), the sampling frame is based on a list derived from the Canadian Child Benefit (CCB) files, which includes a list of all program beneficiaries with their names, addresses, and phone numbers.

## CCHS Sample
The sample for the CCHS is drawn from the respective sampling frames for adults and youth. Approximately 130,000 individuals were selected for the survey, with around 120,000 respondents allocated to the adult population and 10,000 to the youth population. The sample is stratified by health region, ensuring that each health region has a minimum of 500 respondents. The sample for adults is selected from the area frame using a multi-stage sampling process, while the youth sample is directly selected from the CCB list. The allocation for provinces and territories is based on population size, with a focus on achieving representativeness within each health region. 

## CCHS Data Collection
Sample Recruitment for the 2018 Canadian Community Health Survey (CCHS)
The sample for the 2018 CCHS was recruited through a multi-stage, stratified process designed to obtain a representative sample of the Canadian population, aged 12 years and older. The sampling process was divided into two main categories based on the target age groups: individuals aged 18 and older and youths aged 12 to 17.

\noindent
The sample was drawn from two distinct frames:

- Area Frame: This frame was used to select households for respondents aged 18 and older. The area frame covers the entire Canadian population and is designed to represent geographic areas across the country.
- Canadian Child Benefit (CCB) Frame: This frame was used to select households with youths aged 12 to 17. The CCB frame was specifically used to identify youth in households receiving the Canadian Child Benefit.

\noindent
The data collection for the CCHS was carried out using two primary methods:

- Computer-Assisted Telephone Interviewing (CATI): This method was used for approximately 75% of respondents selected from the area frame and for all respondents selected from the CCB frame (aged 12-17). Interviews were conducted over the phone by trained interviewers in centralized call centers.
- Computer-Assisted Personal Interviewing (CAPI): This method was used for about 25% of the area frame respondents. These interviews were conducted face-to-face by decentralized field interviewers using laptops. Interviewers primarily visited households in person, though telephone follow-ups were permitted if necessary.

\noindent
The sampling process was designed to maximize coverage and minimize non-response. Each regional office of Statistics Canada was responsible for assigning cases to interviewers, with careful consideration of the geographic and demographic distribution of respondents. The sample was stratified by health region to ensure representation from each geographic area. Interviewers were assigned cases based on their regional collection office, and the assignments typically included no more than 15 cases per interviewer to ensure manageable workloads. These assignments were planned to be completed in four non-overlapping three-month collection periods, with different phases for initial and follow-up attempts.

\noindent
To optimize the contact process, the interviewers first initiated contact with the selected households by either telephone or personal visit, depending on the sampling frame and mode of data collection. If initial contact was unsuccessful, additional efforts were made to reach the household through scheduled callbacks, including multiple attempts at different times and days. If necessary, personal visits were conducted to obtain the interview.

\noindent
For youths aged 12-17 selected for interviews, interviewers were required to obtain verbal consent from a parent or guardian before interviewing youths aged 12-14. If a parent or guardian requested to see the questionnaire, they were provided with a copy before the interview. In cases where the selected youth was unable to complete the interview, a "Person Most Knowledgeable" (PMK) within the household was interviewed instead. This procedure ensured that household-level information was collected even if the selected youth was unable to provide it.

\noindent
If the selected respondent was unable to participate due to physical or mental health conditions, a proxy interview was conducted. A knowledgeable household member would provide information on behalf of the selected respondent. However, the more personal and sensitive questions were omitted from these interviews, as the proxy could not reliably answer them.

\noindent
Throughout the recruitment process, several quality control measures were in place to ensure the accuracy and validity of the data. A random selection of interviews was validated to ensure the integrity of the data. These validations involved contacting households to confirm that the interview took place and checking the quality of the responses. Cumulative reports were generated at the end of each collection period, showing response rates by region, to help regional offices identify areas that required additional follow-up. Specific sections of interviews were recorded for quality control purposes and analyzed to ensure proper procedures were followed by interviewers.

## CCHS Nonresponse and Nonresponse handling

The Canadian Community Health Survey (CCHS) employs a systematic approach to address nonresponse at both the household and personal levels. This ensures that the survey results remain representative of the general population, even when certain individuals or households do not respond. The nonresponse handling methodology is as follows:

\noindent
1. Household Nonresponse \newline

Nonresponse at the household level occurs when a sampled household either refuses to participate, is unreachable, or provides unusable data. To adjust for nonresponse, the survey sample is divided into response homogeneity groups (RHGs), which group households based on their likelihood of responding. This helps ensure that the adjustment for nonresponse is made based on similar response propensities.
A logistic regression model is used to predict the likelihood of a household responding to the survey. Based on the predicted response probabilities, an adjustment factor is computed within each RHG. This factor helps correct for nonresponse by redistributing the weight of nonresponding households to those that did respond. The final adjustment is made by multiplying the weight of responding households by the adjustment factor, resulting in a new weight. Nonresponding households are excluded from the weighting process after this adjustment.

\noindent
2. Person-Level Nonresponse \newline

The interviewer first collects a complete roster of household members.
A selected individual from the roster is then interviewed. In cases where the selected individual cannot be contacted or refuses to participate, person-level nonresponse occurs. Similar to household nonresponse, an adjustment is applied to the weights of responding individuals to account for those who did not respond. This ensures that the survey remains representative of the entire population. A logistic regression model is applied to estimate the likelihood that a selected individual will respond to the survey. This model uses information gathered during the first part of the interview (e.g., age, sex, etc.) and the location of the household. The selected individuals are then grouped into response homogeneity groups (RHGs) based on their calculated response probabilities. Within each RHG, an adjustment factor is calculated to correct for the personal level.


By including factors such as geographic location and household characteristics in the nonresponse adjustment models, CCHS enhances the likelihood that the adjusted sample is representative of diverse populations across different regions and demographic groups. Also, the distinct handling of household nonresponse (via weight adjustment A6) and person nonresponse (via weight adjustment A9) ensures that both levels of nonresponse are addressed separately, which helps maintain the accuracy of estimates at both the household and individual levels.

However, the use of multiple weighting adjustments, while intended to improve representativeness, can sometimes lead to overfitting or over-adjustment. This may result in a dataset that over-represents certain characteristics at the expense of others, especially if the logistic regression models are not perfectly specified or if important variables are omitted.  Furthermore, even with sophisticated adjustments, response bias  such as social desirability bias or recall bias  can still affect the dataset. Respondents may provide inaccurate or socially desirable answers, and the weighting adjustments cannot fully correct for these biases, especially if they are not uniform across all demographic groups.

\newpage


# References


